!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=!1,n=!1,r=!0,a=!1,h=!0,o=!0,l=[["#eb7414","#964300"],["#086bd1","#0452a2"],["#720303","#4a0202"]],u={NUMBERS:[[45,93,4,5],[2,93,2,5],[5,93,4,5],[10,93,4,5],[15,93,4,5],[20,93,4,5],[25,93,4,5],[30,93,4,5],[35,93,4,5],[40,93,4,5]],SMALL:[2,100,23,5],MEDIUM:[28,100,29,5],LARGE:[60,100,22,5]};function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,n=!1,r=void 0;try{for(var a,h=t[Symbol.iterator]();!(s=(a=h.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){n=!0,r=t}finally{try{s||null==h.return||h.return()}finally{if(n)throw r}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function f(t,e){return t+Math.floor(Math.random()*(e-t+1))}function p(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}}function g(t,e,i,s){var n,r,a,h,o,l,u,d=parseInt,f=Math.round,p="string"==typeof i;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||i&&!p)return null;var g=function(t){var e=t.length,i={};if(e>9){var s;if(s=c(t=t.split(","),4),n=s[0],r=s[1],a=s[2],p=s[3],(e=t.length)<3||e>4)return null;i.r=d("a"==n[3]?n.slice(5):n.slice(4)),i.g=d(r),i.b=d(a),i.a=p?parseFloat(p):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=d(t.slice(1),16),9==e||5==e?(i.r=t>>24&255,i.g=t>>16&255,i.b=t>>8&255,i.a=f((255&t)/.255)/1e3):(i.r=t>>16,i.g=t>>8&255,i.b=255&t,i.a=-1)}return i};return u=e.length>9,u=p?i.length>9||"c"==i&&!u:u,o=g(e),h=t<0,l=i&&"c"!=i?g(i):h?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},h=1-(t=h?-1*t:t),o&&l?(s?(n=f(h*o.r+t*l.r),r=f(h*o.g+t*l.g),a=f(h*o.b+t*l.b)):(n=f(Math.pow(h*Math.pow(o.r,2)+t*Math.pow(l.r,2),.5)),r=f(Math.pow(h*Math.pow(o.g,2)+t*Math.pow(l.g,2),.5)),a=f(Math.pow(h*Math.pow(o.b,2)+t*Math.pow(l.b,2),.5))),p=o.a,l=l.a,p=(o=p>=0||l>=0)?p<0?l:l<0?p:p*h+l*t:0,u?"rgb"+(o?"a(":"(")+n+","+r+","+a+(o?","+f(1e3*p)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*r+256*a+(o?f(255*p):0)).toString(16).slice(1,o?void 0:-2)):null}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;v(this,t),this.set(e,i)}var e,i,s;return e=t,(i=[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"distance",value:function(t){return Math.hypot(t.x-this.x,t.y-this.y)}},{key:"angle",value:function(t){return Math.atan2(t.y-this.y,t.x-this.x)}},{key:"rotate",value:function(t,e){var i=Math.cos(e),s=Math.sin(e),n=this.x,r=this.y;this.x=i*(n-t.x)+s*(r-t.y)+t.x,this.y=i*(r-t.y)-s*(n-t.x)+t.y}}])&&m(e.prototype,i),s&&m(e,s),t}();function w(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var b=function(){function t(e,i,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=new y(e,i),this.worldPos=new y(s.worldPos.x+12*e+5,s.worldPos.y+12*i+5),this.module=s,this.size=6,this.cable=null}var e,i,s;return e=t,(i=[{key:"hit",value:function(t){return!(t.x<this.worldPos.x-5||t.x>this.worldPos.x+this.size||t.y<this.worldPos.y-5||t.y>this.worldPos.y+this.size)}}])&&w(e.prototype,i),s&&w(e,s),t}();function x(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var k=function(){function t(e,i,s,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.main=r,this.pos=new y(e,i),this.size=new y(s,n),this.worldPos=new y(12*e+this.main.offset.x,12*i+this.main.offset.y),this.worldSize=new y(10*s+2*Math.max(s-1,0),10*n+2*Math.max(n-1,0)),this.texture=this.main.spritesheet,this.powerFrom=null,this.powered=!1;var a=s*n;this.textures=Array(a).fill(-1),this.textures[0]=5,this.textures[1]=2,this.textures[2]=2,a>3&&(this.textures[3]=0),a>4&&(this.textures[4]=1);for(var h=a-4,o=0;o<h;o++)Math.random()<.4&&(this.textures[4+o]=f(3,4));p(this.textures),this.lightTexture=this.textures.indexOf(5),this.lightTextureAcc=0,this.lightTextureDur=f(10,250),this.sockets=[];for(var l=0;l<this.textures.length;l++)2==this.textures[l]&&this.sockets.push(new b(l%s,Math.floor(l/s),this))}var e,i,s;return e=t,(i=[{key:"updatePower",value:function(){for(var t=!1,e=0;e<this.sockets.length;e++){var i=this.sockets[e],s=i.cable;s&&(s.endA.plugged&&s.endA.plugged==i?s.endB.plugged&&s.endB.plugged.module==this.powerFrom&&this.powerFrom.powered&&(t=!0):s.endB.plugged&&s.endB.plugged==i&&s.endA.plugged&&s.endA.plugged.module==this.powerFrom&&this.powerFrom.powered&&(t=!0))}this.powered=t,this.powerFrom==this&&(this.powered=!0)}},{key:"getSocket",value:function(t){if(t.x<this.worldPos.x||t.x>this.worldPos.x+this.worldSize.x)return!1;if(t.y<this.worldPos.y||t.y>this.worldPos.y+this.worldSize.y)return!1;for(var e=0;e<this.sockets.length;e++){var i=this.sockets[e];if(i.hit(t))return i}return!1}},{key:"removeSocket",value:function(t){var e=this.sockets.splice(t,1)[0];this.textures[e.pos.y*this.size.x+e.pos.x]=Math.random()<.4?f(3,4):-1}},{key:"update",value:function(t){this.powered?(this.lightTextureAcc+=t,this.lightTextureAcc>this.lightTextureDur&&(this.lightTextureAcc=0,this.textures[this.lightTexture]=f(6,19))):this.textures[this.lightTexture]=5}},{key:"draw",value:function(t){t.fillStyle="#474747",t.beginPath(),t.rect(this.worldPos.x,this.worldPos.y,this.worldSize.x,this.worldSize.y),t.fill();for(var e=this.size.x,i=this.size.y,s=0;s<i;s++)for(var n=0;n<e;n++){var r=this.textures[s*e+n];if(-1!=r){var a=r%10,h=Math.floor(r/10);r>-1&&t.drawImage(this.texture,10*a,10*h,10,10,this.worldPos.x+12*n,this.worldPos.y+12*s,10,10)}}}}])&&x(e.prototype,i),s&&x(e,s),t}();function P(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var A=function(){function t(e,i,s,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modules=[],this.main=n,this.worldSize=new y(94,154),this.map=Array(13).fill().map((function(){return Array(8).fill(0)}));for(var r=0;r<13;r++)for(var a=0;a<8;a++)if(0==this.map[r][a]){var h=Math.min(8-a,5);if(h>5||h<3)break;var o=Math.min(13-r,2);if(o>2||o<1)break;for(var l=f(3,h),u=f(1,o),c=this.checkSpace(a,r,l,u);!c&&l>3&&u>1;)l--,u--,c=this.checkSpace(a,r,l,u);if(!c)break;var d=new k(a,r,l,u,this.main);this.modules.push(d);var p=this.modules.length;a+=d.size.x;for(var g=0;g<d.size.y;g++)for(var v=0;v<d.size.x;v++)this.map[d.pos.y+g][d.pos.x+v]=p}}var e,i,n;return e=t,(i=[{key:"checkSpace",value:function(t,e,i,s){for(var n=0;n<s;n++)for(var r=0;r<i;r++)if(0!=this.map[e+n][t+r])return!1;return!0}},{key:"getSocket",value:function(t){for(var e=0;e<this.modules.length;e++){var i=this.modules[e].getSocket(t);if(i&&!i.cable)return i}return!1}},{key:"updatePowers",value:function(){for(var t=this.main.modulePath,e=0;e<t.length;e++)this.modules[t[e]].updatePower();for(var i=t.length-1;i>-1;i--)this.modules[t[i]].updatePower();this.main.checkComplete()}},{key:"update",value:function(t){this.modules.forEach((function(e){return e.update(t)}))}},{key:"draw",value:function(t){if(t.fillStyle="#222",t.beginPath(),t.rect(this.main.offset.x+Math.round(5),this.main.offset.y+Math.round(2.5),this.worldSize.x-Math.round(10),this.worldSize.y),t.fill(),s&&h){t.fillStyle="rgba(0, 0, 0, .1)";for(var e=0;e<13;e++)for(var i=0;i<8;i++)t.beginPath(),t.rect(12*i+this.main.offset.x,12*e+this.main.offset.y,10,10),t.fill()}this.modules.forEach((function(e){return e.draw(t)}))}}])&&P(e.prototype,i),n&&P(e,n),t}();function M(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var S=function(){function t(e,i,s,n,r,a,h,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.obj=e,this.prop=i,this.duration=n,this.ease=a,this.from=e[i],this.to=s,this.time=-r,this.per=0,this.onUpdate=h,this.onComplete=o}var e,i,s;return e=t,(i=[{key:"update",value:function(t){this.time+=t,this.per=Math.max(0,Math.min(1,this.time/this.duration)),this.obj[this.prop]=this.from+(this.to-this.from)*this.ease(this.per),this.onUpdate&&this.onUpdate(this.per),1==this.per&&this.onComplete&&this.onComplete(this)}}])&&M(e.prototype,i),s&&M(e,s),t}();function E(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}S.EASE={LINEAR:function(t){return t},IN_QUAD:function(t){return t*t},OUT_QUAD:function(t){return t*(2-t)},INOUT_QUAD:function(t){return t<.5?2*t*t:(4-2*t)*t-1},IN_ELASTIC:function(t){return.04*t/--t*Math.sin(25*t)},OUT_ELASTIC:function(t){return(.04-.04/t)*Math.sin(25*t)+1}};var C=function(){function t(e,i,s,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.pos=new y(i,s),this.length=r,this.angle=n,this.parent=null}var e,i,s;return e=t,(i=[{key:"update",value:function(t,e){var i,s=this.worldPosition();if(e){var n=s.angle(e);i=s.angle(t)-n,this.angle+=i}else this.angle=s.angle(t);this.parent&&(e?e.rotate(s,-i):e=new y(s.x+Math.cos(this.angle)*this.length,s.y+Math.sin(this.angle)*this.length),this.parent.update(t,e))}},{key:"worldAngle",value:function(){return this.parent?this.angle+this.parent.worldAngle():this.angle}},{key:"worldPosition",value:function(){var t=new y(this.pos.x,this.pos.y);return this.parent&&((t=this.parent.worldPosition()).x+=Math.cos(this.parent.worldAngle())*this.parent.length,t.y+=Math.sin(this.parent.worldAngle())*this.parent.length),t}},{key:"worldEndPosition",value:function(){var t=this.worldPosition(),e=this.worldAngle();return new y(t.x+Math.cos(e)*this.length,t.y+Math.sin(e)*this.length)}}])&&E(e.prototype,i),s&&E(e,s),t}();function T(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var B=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bones=[],this.points=[];for(var s=i/5,n=0;n<5;n++)this.bones.push(new C(n,0,0,360*Math.random(),s));this.firstBone().pos.set(e.x,e.y),this.updateParents(),this.updatePoints()}var e,i,s;return e=t,(i=[{key:"reverse",value:function(t){var e=2*Math.PI,i=this.firstBone(),s=this.lastBone(),n=s.worldEndPosition(),r=(s.worldAngle()+Math.PI)%e,a=this.bones.map((function(t){return t.angle}));this.bones.reverse(),this.updateParents(),i=this.firstBone(),s=this.lastBone(),i.pos.set(n.x,n.y),i.angle=r;for(var h=1;h<4;h++)this.bones[h].angle=-a[5-h];s.angle+=s.worldPosition().angle(t)-s.worldAngle()}},{key:"update",value:function(t){var e=this.lastBone();e.update(t),e.angle+=e.worldPosition().angle(t)-e.worldAngle(),this.updatePoints()}},{key:"updateParents",value:function(){for(var t=1;t<5;t++)this.bones[t].parent=this.bones[t-1];this.firstBone().parent=null}},{key:"updatePoints",value:function(){this.points=this.bones.reduce((function(t,e){var i=e.worldPosition();return t.push(i.x,i.y),t}),[]);var t=this.lastBone().worldEndPosition();this.points.push(t.x,t.y)}},{key:"firstBone",value:function(){return this.bones[0]}},{key:"lastBone",value:function(){return this.bones[4]}}])&&T(e.prototype,i),s&&T(e,s),t}();function I(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var O=function(){function t(e,i,s,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.endA={pos:new y(e.x,e.y),plugged:null},this.endB={pos:new y(e.x,e.y+i),plugged:null},this.cursor=null,this.order=[this.endB,this.endA],this.chain=new B(e,i),this.lastDrag=this.endB,this.length=i,this.alpha=1,this.wireColor=s,this.plugColor=n,this.main=r,this.dropped=!1,this.type=0}var e,i,h;return e=t,(i=[{key:"resizeChain",value:function(t){this.length=t,this.chain=new B(this.endA.pos,t)}},{key:"hit",value:function(t){return!this.dropped&&(this.endA.pos.distance(t)<10?(this.order=[this.endA,this.endB],this.lastDrag!=this.endA&&this.chain.reverse(this.endA.pos),this.lastDrag=this.endA,!0):this.endB.pos.distance(t)<10&&(this.order=[this.endB,this.endA],this.lastDrag!=this.endB&&this.chain.reverse(this.endB.pos),this.lastDrag=this.endB,!0))}},{key:"press",value:function(t){this.dropped||(this.cursor=t,this.main.killAnimationsOf([this.endA.pos,this.endB.pos]))}},{key:"release",value:function(t,e){var i=this;if(!this.dropped){if(this.cursor=null,this.order[0].pos.distance(this.order[1].pos)>this.length&&(e=null),e&&!e.cable)this.order[0].pos.set(e.worldPos.x,e.worldPos.y),this.order[0].plugged=e,e.cable=this,e.module.updatePower(),this.main.rack.updatePowers(),this.updateIK(this.order[0].pos);else{var s=this.chain.lastBone().worldEndPosition();this.order[0].pos.set(s.x,s.y)}if(this.order[0].plugged||this.order[1].plugged){if(!this.order[0].plugged&&this.order[1].plugged){var n=Math.random()*Math.PI*2,r=new y(this.order[1].pos.x+Math.cos(n)*(.25*this.length+7.5),this.order[1].pos.y+Math.sin(n)*(.25*this.length+7.5));r.x=Math.max(Math.min(r.x,this.main.canvas.width-10),10),r.y=Math.max(Math.min(r.y,this.main.canvas.height-10),10),this.main.addAnimation(new S(this.order[0].pos,"x",r.x,750,0,S.EASE.OUT_ELASTIC,(function(t){return i.chain.update(i.order[0].pos)}))),this.main.addAnimation(new S(this.order[0].pos,"y",r.y,750,0,S.EASE.OUT_ELASTIC))}}else this.dropped=!0,this.main.addAnimation(new S(this,"alpha",0,200,0,S.EASE.LINEAR,null,(function(){i.main.deleteCable(i)})))}}},{key:"drag",value:function(t){if(!this.dropped&&(this.order[0].pos.set(t.x,t.y),this.updateIK(t),this.order[0].plugged)){var e=this.order[0].plugged;this.order[0].plugged.cable=null,this.order[0].plugged=null,e.module.updatePower(),this.main.rack.updatePowers()}}},{key:"updateIK",value:function(t){for(var e=0;e<200;e++)this.chain.update(t)}},{key:"update",value:function(t){}},{key:"draw",value:function(t){var e=this.length/2,i=2*Math.PI,h=this.chain.points;if(this.dropped)for(var o=1;o<h.length;o+=2)h[o]+=5;if(t.globalAlpha=this.alpha,t.fillStyle=this.plugColor,t.beginPath(),t.fillRect(h[0]-2,h[1]-2,4,4),t.fillRect(h[h.length-2]-2,h[h.length-1]-2,4,4),t.closePath(),t.strokeStyle=this.wireColor,t.lineWidth=2,t.beginPath(),function(t,e,i,s,n){i="number"==typeof i?i:.5,s=s||25;var r,a=1,h=e.length,o=0,l=new Float32Array((h-2)*s+2+(n?2*s:0)),u=new Float32Array(4*(s+2)),c=4;for(r=e.slice(0),n?(r.unshift(e[h-1]),r.unshift(e[h-2]),r.push(e[0],e[1])):(r.unshift(e[1]),r.unshift(e[0]),r.push(e[h-2],e[h-1])),u[0]=1;a<s;a++){var d=a/s,f=d*d,p=f*d,g=2*p,v=3*f;u[c++]=g-v+1,u[c++]=v-g,u[c++]=p-2*f+d,u[c++]=p-f}function m(t,e,n){for(var r,a=2;a<n;a+=2){var h=t[a],u=t[a+1],c=t[a+2],d=t[a+3],f=(c-t[a-2])*i,p=(d-t[a-1])*i,g=(t[a+4]-h)*i,v=(t[a+5]-u)*i;for(r=0;r<s;r++){var m=r<<2,y=e[m],w=e[m+1],b=e[m+2],x=e[m+3];l[o++]=y*h+w*c+b*f+x*g,l[o++]=y*u+w*d+b*p+x*v}}}for(u[++c]=1,m(r,u,h),n&&((r=[]).push(e[h-4],e[h-3],e[h-2],e[h-1]),r.push(e[0],e[1],e[2],e[3]),m(r,u,4)),h=n?0:e.length-2,l[o++]=e[h],l[o]=e[h+1],a=0,h=l.length;a<h;a+=2)t.lineTo(l[a],l[a+1])}(t,h,.5,10,!1),t.stroke(),t.closePath(),t.globalAlpha=1,s){if(t.lineWidth=1,t.globalAlpha=1,n&&(t.strokeStyle="rgba(0, 150, 0, .5)",t.beginPath(),t.arc(this.order[0].pos.x,this.order[0].pos.y,e,0,i),t.stroke(),t.closePath(),t.strokeStyle="rgba(255, 0, 0, .5)",t.beginPath(),t.arc(this.order[1].pos.x,this.order[1].pos.y,e,0,i),t.stroke(),t.closePath()),r){t.fillStyle="#000000",t.strokeStyle="#000000";for(var l=0;l<this.chain.bones.length;l++){var u=this.chain.bones[l],c=u.worldPosition(),d=u.worldAngle();t.beginPath(),t.arc(c.x,c.y,1,0,i),t.fill(),t.moveTo(c.x,c.y),t.lineTo(c.x+Math.cos(d)*u.length,c.y+Math.sin(d)*u.length),t.stroke(),t.closePath()}}a&&(t.fillStyle="rgba(255, 255, 255, .25)",t.beginPath(),t.arc(this.endA.pos.x,this.endA.pos.y,10,0,i),t.fill(),t.closePath(),t.beginPath(),t.arc(this.endB.pos.x,this.endB.pos.y,10,0,i),t.fill(),t.closePath())}}}])&&I(e.prototype,i),h&&I(e,h),t}();function L(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.spritesheet=new Image,this.spritesheet.onload=this.init.bind(this),this.spritesheet.src="spritesheet.png"}var e,i,n;return e=t,(i=[{key:"init",value:function(){document.body.style.backgroundColor="#cc4d4d",this.canvas=document.querySelector("#canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.msImageSmoothingEnabled=!1;var t=this.canvas.width=94,e=this.canvas.height=154;this.offset=new y,this.canvas.width<110&&(this.canvas.width=110),this.canvas.height<75&&(this.canvas.height=75),this.canvas.width+=50,this.canvas.height+=50,this.offset.x=Math.round((this.canvas.width-t)/2),this.offset.y=Math.round((this.canvas.height-e)/2),this.dimAlpha=0,this.scale=1,this.dimmed=!1,this.hilight=-1,this.note=!0,this.animations=[],this.cables=[],this.cableCounts=[0,0,0],this.cableLengths=[0,0,0],this.socket=null,this.prevTime=0,this.cursor=new y,this.cable=null,this.gameloop=this.update.bind(this),this.rack=new A(this.canvas.width,this.canvas.height,this.spritesheet,this);var i=this.rack.modules.length;this.modulePath=[];for(var s=0;s<i;s++)this.modulePath.push(s);p(this.modulePath);for(var n=this.rack.modules[this.modulePath[0]],r=this.rack.modules[this.modulePath[1]],a=1e6,h=0,o=2;o<i+1;o++){var u=n.sockets[0],c=r.sockets[1],d=l[f(0,l.length-1)],v=.1*Math.random()-.05,m=u.worldPos.distance(c.worldPos);m>h&&(h=m),m<a&&(a=m);var w=new O(u.worldPos,1.1*m,g(v,d[0]),g(v,d[1]),this);w.endA.plugged=u,u.cable=w,w.endB.plugged=c,c.cable=w,w.endB.pos.set(c.worldPos.x,c.worldPos.y),w.updateIK(c.worldPos),this.cables.push(w),r.powerFrom=n,n=r,r=this.rack.modules[this.modulePath[o]]}var b=(h-(a+=50))/2;this.cableLengths=[a,a+b,a+2*b];for(var x=0;x<this.cables.length;x++){for(var k=this.cables[x],P=0;k.length>a+P*b&&2!=++P;);this.cableCounts[P]++,k.type=P,k.resizeChain(1.1*(a+P*b)),k.updateIK(k.endB.pos);var M=.1*Math.random()-.05;k.wireColor=g(M,l[P][0]),k.plugColor=g(M,l[P][1])}this.rack.modules[this.modulePath[0]].removeSocket(1),this.rack.modules[this.modulePath[i-1]].removeSocket(0),this.rack.modules[this.modulePath[0]].powered=!0,this.rack.modules[this.modulePath[0]].powerFrom=this.rack.modules[this.modulePath[0]];for(var S=1;S<i;S++)this.rack.modules[this.modulePath[S]].powered=!1;for(var E=0;E<this.cables.length;E++){var C=this.cables[E];C.endA.plugged&&(C.endA.plugged.cable=null),C.endB.plugged&&(C.endB.plugged.cable=null)}this.cables=[],this.resize(),this.canvas.addEventListener("touchstart",this.mousedown.bind(this)),this.canvas.addEventListener("touchend",this.mouseup.bind(this)),this.canvas.addEventListener("touchcancel",this.mouseup.bind(this)),this.canvas.addEventListener("touchmove",this.mousemove.bind(this)),this.canvas.addEventListener("mousedown",this.mousedown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseup.bind(this)),this.canvas.addEventListener("mouseleave",this.mouseup.bind(this)),this.canvas.addEventListener("mousemove",this.mousemove.bind(this)),window.addEventListener("resize",this.resize.bind(this)),this.gameloop(0)}},{key:"mousedown",value:function(t){if(t&&t.preventDefault(),this.note)this.note=!1;else if(!(this.dimAlpha>0)){var e=this.getEventPos(t);this.updateCursor(e[0],e[1]);for(var i=0;i<this.cables.length;i++){var s=this.cables[i];if(s.hit(this.cursor)){this.cable=s;break}}this.cable?(this.cables.splice(this.cables.indexOf(this.cable),1),this.cables.push(this.cable),this.cable.press(this.cursor)):(this.socket=this.rack.getSocket(this.cursor),this.socket&&this.dim(!0))}}},{key:"dim",value:function(t){this.dimmed=t,this.killAnimationsOf(this),this.addAnimation(new S(this,"dimAlpha",t?1:0,200,0,S.EASE.LINEAR))}},{key:"deleteCable",value:function(t){this.cableCounts[t.type]++;var e=this.cables.indexOf(t);e>-1&&this.cables.splice(e,1)}},{key:"checkComplete",value:function(){for(var t=!0,e=0;e<this.rack.modules.length;e++)if(!this.rack.modules[e].powered){t=!1;break}t&&(window.document.title="200",document.body.style.backgroundColor="#548d38",window.open("https://js13kgames.com/entries"))}},{key:"getEventPos",value:function(t){return t.changedTouches&&t.changedTouches[0]?[t.changedTouches[0].clientX/this.scale,t.changedTouches[0].clientY/this.scale-this.canvas.getBoundingClientRect().top/this.scale]:t.touches&&t.touches[0]?[t.touches[0].clientX/this.scale,t.touches[0].clientY/this.scale-this.canvas.getBoundingClientRect().top/this.scale]:[t.offsetX,t.offsetY]}},{key:"mouseup",value:function(t){t&&t.preventDefault();var e=this.getEventPos(t);if(this.updateCursor(e[0],e[1]),this.dimmed){if(this.dim(!1),this.socket&&this.hilight>-1){if(0==this.cableCounts[this.hilight])return;var i=l[this.hilight],s=.1*Math.random()-.05,n=this.cableLengths[this.hilight],r=new O(this.socket.worldPos,1.1*n,g(s,i[0]),g(s,i[1]),this);r.endA.plugged=this.socket,this.socket.cable=r,r.type=this.hilight,this.cableCounts[r.type]--;var a=Math.random()*Math.PI*2,h=new y(r.endA.pos.x+Math.cos(a)*(.25*r.length+7.5),r.endA.pos.y+Math.sin(a)*(.25*r.length+7.5));h.x=Math.max(Math.min(h.x,this.canvas.width-10),10),h.y=Math.max(Math.min(h.y,this.canvas.height-10),10),this.addAnimation(new S(r.endB.pos,"x",h.x,750,0,S.EASE.OUT_ELASTIC,(function(t){return r.chain.update(r.endB.pos)}))),this.addAnimation(new S(r.endB.pos,"y",h.y,750,0,S.EASE.OUT_ELASTIC)),r.endB.plugged=null,r.endB.pos.set(h.x,h.y),r.updateIK(this.socket.worldPos),this.cables.push(r),this.hilight=-1}}else this.cable&&this.cable.release(this.cursor,this.rack.getSocket(this.cursor)),this.cable=null}},{key:"mousemove",value:function(t){t&&t.preventDefault();var e=this.getEventPos(t);if(this.updateCursor(e[0],e[1]),this.dimmed){var i=Math.round(this.canvas.width/3);return this.hilight=Math.floor(this.cursor.x/i),void(this.hilight<0?this.hilight=0:this.hilight>2&&(this.hilight=2))}this.cable&&this.cable.drag(this.cursor)}},{key:"updateCursor",value:function(t,e){this.cursor.set(t,e)}},{key:"update",value:function(t){var e=this,i=t-this.prevTime;if(this.prevTime=t,this.animations=this.animations.reduce((function(t,e){return e.update(i),1!=e.per&&t.push(e),t}),[]),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.rack.update(i),this.rack.draw(this.ctx),this.cables.forEach((function(t){t.update(i),t.draw(e.ctx)})),this.dimAlpha>0){this.ctx.fillStyle="rgba(0, 0, 0, "+.7*this.dimAlpha+")",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var n=Math.ceil(this.canvas.width/3);this.ctx.globalAlpha=.2*this.dimAlpha,this.hilight>-1&&(this.ctx.fillStyle=l[this.hilight][0],this.ctx.fillRect(Math.round(this.hilight*n),0,n,this.canvas.height)),this.ctx.globalAlpha=this.dimAlpha;for(var r=[u.SMALL,u.MEDIUM,u.LARGE],a=u.NUMBERS,h=0;h<r.length;h++){var c=r[h],d=Math.round(h*n+(n-c[2])/2),f=Math.round((this.canvas.height-c[3])/2)+c[3];this.ctx.drawImage(this.spritesheet,c[0],c[1],c[2],c[3],d,f,c[2],c[3]);for(var p=this.cableCounts[h].toString(),g=0,v=0;v<p.length;v++)g+=a[p[v]][2],v<p.length-1&&(g+=1);for(var m=Math.round(h*n+(n-g)/2),y=0;y<p.length;y++){var w=p[y];this.ctx.drawImage(this.spritesheet,a[w][0],a[w][1],a[w][2],a[w][3],m,f-a[w][3]-5,a[w][2],a[w][3]),m+=a[w][2]+1}}this.ctx.globalAlpha=1}if(this.note){var b=Math.round((this.canvas.width-106)/2),x=Math.round((this.canvas.height-70)/2);this.ctx.drawImage(this.spritesheet,2,22,106,70,b,x,106,70)}s&&o&&(this.ctx.strokeStyle="rgba(0, 150, 0, .5)",this.ctx.beginPath(),this.ctx.arc(this.cursor.x,this.cursor.y,5,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath()),requestAnimationFrame(this.gameloop)}},{key:"killAnimationsOf",value:function(t){Array.isArray(t)?this.animations=this.animations.filter((function(e){t.includes(e.obj)})):this.animations=this.animations.filter((function(t){t.obj}))}},{key:"addAnimation",value:function(t){this.animations.push(t)}},{key:"resize",value:function(){var t=1*window.innerWidth/this.canvas.width,e=1*window.innerHeight/this.canvas.height,i=Math.min(t,e);i=Math.min(4,i),this.canvas.style.transform="scale(".concat(i,")"),this.scale=i}}])&&L(e.prototype,i),n&&L(e,n),t}())}]);