(function(e,t){var n=e.document,r=e.navigator,i=Object.prototype.hasOwnProperty,s=Array.prototype.slice,o={type:{},all:function(e,t){return Array.prototype.slice.call((t||n).querySelectorAll(e))},augment:function(e,t){function r(){t.apply(this,arguments),e.apply(this,arguments)}function i(){}var n=this;return i.prototype=t.prototype,r.superclass=t.prototype,r.prototype=new i,r.prototype.constructor=r,o.merge(r.prototype,e.prototype),r},bind:function(e,n,r){var i=this;return r!==t&&(r=s.call(arguments,2)),function(o){return o!==t&&(o=s.call(arguments),r!==t&&(o=o.concat(r))),e.apply(n||i,o||r)}},forEach:function(e,t,n){var r=this,s;if(Array.isArray(e))e.forEach(function(){t.apply(n||this,arguments)});else for(s in e)i.call(e,s)&&t.call(n||e,e[s],s,e);return e},isNode:function(e){return e.nodeType||this.isWindow(e)},isString:function(e){return typeof e=="string"},isWindow:function(e){return!!(e&&e.alert&&e.document)},merge:function(e,t){var n=this,r;for(r in t)i.call(t,r)&&(e[r]=t[r]);return e},one:function(e,t){var r=this;return r.isNode(e)?e:(t||n).querySelector(e)}};o.math={distance:function(e,t,n,r){var i=n-e,s=r-t;return Math.sqrt(i*i+s*s)}};var u=function(){var e=this;e.attrs_={}};u.prototype={attrs_:null,setAttrs:function(e,t){var n=this;o.forEach(e,function(e,r){t?n.attrs_[r]=e:n.set(r,e)})},set:function(e,t){var n=this,r=n[e+"Change_"];return n.attrs_[e]=t,r&&r.call(n,t,e),t},get:function(e){var t=this;return t.attrs_[e]},getAttrs:function(){var e=this;return e.attrs_},linkAttr:function(e,t,n){var r=this,i=e+"Change_",s=r[i];r[i]=function(n){s&&s.apply(this,arguments),t.set(e,n)},n&&t.set(e,r.get(e))}},o.Attribute=u;var a=function(e){var t=this;t.setAttrs(o.merge({height:240,visible:!0,width:320},e),!0)};a.prototype={domElement:null,heightChange_:function(e){var t=this;t.domElement.height=e},hide:function(){var e=this;return e.set("visible",!1),e},render:function(e){var t=this;return t.heightChange_(t.get("height")),t.visibleChange_(t.get("visible")),t.widthChange_(t.get("width")),o.one(e||n.body).appendChild(t.domElement),t},show:function(){var e=this;return e.set("visible",!0),e},visibleChange_:function(e){var t=this;t.domElement.style.display=e?"block":"none"},widthChange_:function(e){var t=this;t.domElement.width=e}},o.DomElement=o.augment(a,o.Attribute);var f=function(e){var t=this;t.createCanvas_()};f.prototype={context:null,createCanvas_:function(){var e=this,t=n.createElement("canvas");e.domElement=t,e.context=t.getContext("2d")},getImageData:function(e,t,n,r){var i=this,s=e||0,o=t||0,u=n||i.get("width"),a=r||i.get("height");return i.context.getImageData(s,o,u,a)},setImageData:function(e,t,n){var r=this,i=t||0,s=n||0;return r.context.putImageData(e,i,s),r},forEach:function(e,t,n){var r=this,i=e.width,s=e.height,o=e.data,u=0,a=0,f;for(u=0;u<s;u++)for(a=0;a<i;a++)f=u*i*4+a*4,t.call(r,o[f],o[f+1],o[f+2],o[f+3],f,u,a)},toDataURL:function(e){var t=this;return t.domElement.toDataURL(e||"image/png")},transform:function(e){var t=this,n=t.getImageData(),r=t.context.createImageData(n),i=r.data;return t.forEach(n,function(e,t,n,r,s,o,u){var a=(e+t+n)/3;i[s]=a,i[s+1]=a,i[s+2]=a,i[s+3]=255}),t.setImageData(r),t}},o.Canvas=o.augment(f,o.DomElement);var l=function(e){var t=this;t.setAttrs(o.merge({autoplay:!0,controls:!0},e),!0),t.trackers_={},t.createVideo_(),t.createCanvas_()};l.prototype={canvas:null,trackers_:null,createCanvas_:function(){var e=this;e.canvas=new o.Canvas,e.linkAttr("height",e.canvas,!0),e.linkAttr("width",e.canvas,!0)},createVideo_:function(){var e=this,t=e.get("autoplay"),r=n.createElement("video");r.autoplay=t,r.controls=e.get("controls"),e.domElement=r,t&&e.play()},getVideoCanvasImageData:function(){var e=this;return e.syncVideoCanvas(),e.canvas.getImageData()},load:function(){var e=this,t=e.domElement;return t.load.apply(t,arguments),e},loop_:function(){var e=this,t=0,n=e.trackers_,r;o.forEach(n,function(t,n){r=o.type[n],r.track&&r.track(t,e)}),Object.keys(n).length&&requestAnimationFrame(function(){e.loop_()})},pause:function(){var e=this,t=e.domElement;return t.pause.apply(t,arguments),e},play:function(){var e=this,t=e.domElement;return t.play.apply(t,arguments),e},renderVideoCanvas:function(e){var t=this;return t.syncVideoCanvas(),o.one(e||n.body).appendChild(t.canvas.domElement),t},srcChange_:function(e){var t=this;t.domElement.src=e},stopTracking:function(){var e=this;e.trackers_={}},syncVideoCanvas:function(){var e=this,t=e.domElement,n=e.get("width"),r=e.get("height");return t.readyState===t.HAVE_ENOUGH_DATA&&e.canvas.context.drawImage(e.domElement,0,0,n,r),e},toDataURL:function(e){var t=this;return t.syncVideoCanvas(),t.canvas.toDataURL(e)},track:function(e){var t=this,n=o.type[e.type.toUpperCase()],r=t.trackers_;if(!n)throw Error("A tracker type should be specified.");r[n.NAME]||(r[n.NAME]=[]),r[n.NAME].push(e),Object.keys(r).length===1&&t.loop_()}},o.Video=o.augment(l,o.DomElement);var c=function(e){var t=this;t.setAttrs(o.merge({audio:!0},e),!0),t.initUserMedia_()};c.prototype={initUserMedia_:function(){var e=this;r.getUserMedia(r.mozGetUserMedia?{video:!0}:{audio:e.get("audio"),video:!0},o.bind(e.defSuccessHandler_,e),o.bind(e.defErrorHandler_,e))},defSuccessHandler_:function(e){var t=this;try{t.set("src",URL.createObjectURL(e))}catch(n){t.set("src",e)}},defErrorHandler_:function(e){throw Error(e)}},o.VideoCamera=o.augment(c,o.Video),self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),e.URL||(e.URL=e.URL||e.webkitURL||e.msURL||e.oURL),r.getUserMedia||(r.getUserMedia=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia),function(){var t=0,n=["ms","moz","webkit","o"],r;for(r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(),e.tracking=o})(window);