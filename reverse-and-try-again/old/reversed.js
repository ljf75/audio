"use strict";function $s(e){return document.querySelectorAll(e).item(0)}function $(e){return document.getElementById(e)}function n$(e){return document.createElement(e)}function game(e){function t(e,t){for(var n=null,i=0;i<e.length;i++)if(n=t(e[i],i))return n}function n(){function e(e,t,n,i,a){for(var r=[],o=0;a>o;o++)r.push([n+o*i,t,e]);return r}var t=C.objs,n=[];n=n.concat(e(t.signWarn,1.25,0,z,5)),n=n.concat(e(t.signSlip,-1.25,15*z,z,5));var i=e(t.tree,2,0,2*z,20),a=[[z,0,t.checkpoint]],r=[[z,0,t.startLine]],o=e(t.tunnelLight,0,z/2,z,20);o=o.concat(e(t.tunnelLight,-1,z/2,z,20)),o=o.concat(e(t.tunnelLight,1,z/2,z,20));var l=function(n,i,a){return e(t.boost,n,i*z,z,a)},c=C.hillTypes,s=C.cornerTypes;return new C([new x(s.straight,20,n.concat(l(.75,2,10)).concat(r),c.flat,!1),new x(s.left,20,i.concat(l(-.25,5,5)),c.down,!1),new x(s.straight,10,i.concat(a),c.down,!1),new x(s.straight,20,o.concat(l(-.75,10,5)),c.flat,!0),new x(s.straight,10,i,c.up,!1),new x(s.left,20,i.concat(l(0,2,5)).concat(a),c.flat,!1),new x(s.right,20,i,c.up,!1),new x(s.straight,20,n.concat(l(.25,4,5)).concat(a),c.down,!1),new x(s.right,20,n,c.down,!1)])}function i(e,t,n,i,a,r,o){return{x:e,secIdx:t,zoff:n,color:i,acceleration:a,turnSpeed:r,maxSpeed:o,direction:0,speed:0,lap:0,reversed:!1,accelerating:!1,braking:!1,isCar:!0,lastCheckpointOffset:0,lastCheckpointSection:0}}function a(){function t(e,t,n){e.fillStyle=t,e.beginPath(),e.moveTo(n[0],I),e.lineTo(n[1],pe),e.lineTo(n[2],pe),e.lineTo(n[3],I),e.fill()}function n(e,n,i,a){var r=a*te*T,o=a*ee*T,l=T/2+(i*ee*T-o/2),c=T/2+(i*te*T-r/2),s=c+r,d=l+o;t(e,n,[l,c,s,d])}function i(e,t,i,a,r,o){var l=n$("canvas");l.width=T,l.height=I;var c=l.getContext("2d");return c.rect(0,0,T,I),c.fillStyle=e,c.fill(),n(c,t,0,1),n(c,i,.5,ne),n(c,i,-.5,ne),n(c,a,.25,ie),n(c,a,0,ie),n(c,a,-.25,ie),o&&o(c),r&&(c.save(),c.translate(0,I),c.scale(1,-1),c.drawImage(r,0,0,M,pe,0,0,T,I/2),c.restore()),l}function a(e,t,i,a){for(var r=1/a,o=0;r>o;o++)n(e,o%2==0?t:i,-.5+a*o,a)}function r(e,t){var n=n$("canvas");n.width=ee*T,n.height=I;var i=n.getContext("2d");return i.fillStyle=e?"#CCCCCC":"black",i.fillRect(0,0,n.width,t?I:I/3),n}function o(){var e=50,t=n$("canvas");t.width=e,t.height=2*I/3;var n=t.getContext("2d");return n.fillStyle="yellow",n.beginPath(),n.arc(e/2,0,e/2,0,Math.PI),n.fill(),t}function l(e,t,n,i,a,r,o){var l=n$("canvas");l.width=e,l.height=t+n;var c=l.getContext("2d");return c.fillStyle="#DDD",c.fillRect(r*e-2,0,4,t+n),c.fillRect((1-r)*e-2,0,4,t+n),c.fillStyle=a,c.fillRect(0,0,e,t),c.fillStyle=i,c.fillRect(2,2,e-4,t-4),o&&o(c),l}function c(e,t,n,i,a,r,o,c){return l(e,t,n,i,a,c,function(n){var i=.85*t;n.font=i+"px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle=o,n.fillText(r,e/2,t/2,e)})}function s(e){var t=n$("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),n.globalCompositeOperation="source-atop",n.fillStyle="rgba(255,255,255,1.0)",n.fillRect(0,0,t.width,t.height),t}function d(e,t,n){var i=n$("canvas");i.width=M,i.height=pe;var a=i.getContext("2d"),r=(1-n)*pe,o=n*pe,l=a.createLinearGradient(0,o,0,o+r);return l.addColorStop(0,e),l.addColorStop(1,t),a.fillStyle=l,a.fillRect(0,0,M,pe),i}function f(e){for(var t=e.getContext("2d"),n=t.getImageData(0,0,1,pe),i=[],a=0;pe>a;a++)i.push(n.data[4*a+3]);return i}function h(e,t,n){var i=n$("canvas");i.width=T,i.height=I;var a=i.getContext("2d");a.fillStyle=e,a.fillRect(0,0,T,I),a.fillStyle=t,a.fillRect(0,I/2+5,T,I/2),a.fillStyle="white";for(var r=[[.25*T,1/6*I,.35],[.5*T,.25*I,.25],[.75*T,.2*I,.3],[1*T,1/8*I,.2]],o=0;o<r.length;o++)a.font=I*r[o][2]+"px Arial",a.fillText("\u2601",r[o][0],r[o][1]+30);return n&&(a.drawImage(n,0,0,M,pe,0,0,T,I-pe+5),a.drawImage(n,0,pe-1,M,1,0,I/2+5,T,I/2)),i}function u(e,t){var n=n$("canvas");n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height;var i=n.getContext("2d");return i.globalAlpha=t,i.drawImage(e,0,0),n}function p(e){var t=n$("canvas");t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height;var n=t.getContext("2d");return n.imageSmoothingEnabled=!1,n.translate(e.width,0),n.scale(-1,1),n.drawImage(e,.5,0),t}function g(e){for(var t=[],n=50,i=8,a=e;a>0;a--)t.push(n*i/a);return t}function v(e,t,n,i,a,r){var o=n$("canvas");o.width=t,o.height=n;var l=o.getContext("2d");return l.fillStyle=i,l.strokeStyle=a,l.textAlign="center",l.font=.85*n+"px Arial",l.lineWidth=r,l.fillText(e,t/2,n,t),l.strokeText(e,t/2,n,t),o}function w(e,t,n,i,a){var r=n$("canvas");r.width=t,r.height=n;var o=r.getContext("2d");return o.fillStyle=i,o.arc(t/2,n/2,t/2,0,2*Math.PI),o.fill(),o.beginPath(),o.fillStyle=a,o.font="normal normal bold "+.75*n+"px Arial",o.textAlign="center",o.textBaseline="middle",o.shadowColor="rgba(40,40,40,0.8)",o.shadowOffsetX=4,o.shadowOffsetY=4,o.fillText(e,t/2,n/2,t),r}function b(){var e=0>j?T+j:j,t=Math.min(M,T-e);K.drawImage(se,e,0,t,I,0,0,t,I),M>t&&K.drawImage(se,0,0,M-t,I,t,0,M-t,I)}function m(e,t,n,i,a,r){return{obj:e,s:a,x:t,y:n,z:i,sy:r}}function y(e,t,n){for(var i=t,a=e,r=0,o=0,l=0,c=0,s=0,d=A.sections[a],f=0,h=-1,u=[],p=.005,g=1,v=-1*n*(ee/2*T),w=0,b=0,y=0,C=0,S=!1,k=!1,$=!1,j=null,L=0,E=0;pe>E&&(L=(ge[E]||-1)+i,0>h&&(h=L-(ge[1]-ge[0])),!(L-i>80));E+=1){S=!1,k=!1;var B=A.normalizeSection(a,L),X=A.sections[B.s];if(X!=d&&(r=E,o=f,c=s*(L-h),X.isTunnel&&!d.isTunnel&&(S=!0),l=L-B.o),X.isTunnel&&pe>E+1){var R=A.sectionFromOffset(a,(ge[E+1]||-1)+i);A.sections[R].isTunnel||(k=!0)}p=X.hillType,b=b+g+100*p*(h-L),s=X.cornerType;var O=(1-E/pe)*v;C=C+s*(h-L)-c;var P=C+O;if(!(0>L)){var F=Math.floor(L/z)%2==0,W=X.isTunnel?F?le:ce:F?re:oe;Math.ceil(b-w)>0&&(K.beginPath(),K.drawImage(W,T/2-M/2+P,I-Math.floor(E),M,1,0,I-Math.floor(b),M,Math.ceil(b-w)+.5),w=b,y=L);var H=(E-pe-te/ee*E)/pe,U=X.objects;for(N=0;N<U.length;N++)U[N][0]>h-l&&U[N][0]<=L-l&&u.unshift(m(we[U[N][2].id],-1*P+U[N][1]*(T/2)*H*ee,b,L,H,E));for(N=0;N<D.length;N++)A.sections[D[N].secIdx]==X&&D[N].zoff>h-l&&D[N].zoff<=L-l&&u.unshift(m(x(D[N]),-1*P+D[N].x*(T/2)*H*ee,b,L,H,E));S&&($=!1,j=m(he,-1*P,b,L,H,E),u.unshift(j)),k&&($=!0,u.unshift(m(fe,-1*P,b,L,H,E))),d=X,f=C,h=L}}K.save(),K.beginPath(),K.rect(0,0,M,I-Math.floor(w)),K.clip();var q=A.sections[a].isTunnel;$||(q||j)&&u.unshift(m(ue,0,w,L,(-1-te/ee*(pe-1))/pe));for(var G=!1,N=0;N<u.length;N++){var Y=u[N];if(Y.obj&&Y.obj.i){Y.z<y&&(G=!0,K.restore(),K.beginPath());var J=Y.obj.i.width,Q=Y.obj.i.height,V=J*Y.s,Z=Q*Y.s;if(K.drawImage(Y.obj.i,0,0,J,Q,M/2+Y.x-V/2+V,I-Y.y+Z,-1*V,-1*Z),Y.obj.m){var _=de[Y.sy]/255;K.save(),K.globalAlpha=_,K.drawImage(Y.obj.m,0,0,J,Q,M/2+Y.x-V/2+V,I-Y.y+Z,-1*V,-1*Z),K.restore()}if((Y.obj==fe||Y.obj==he||Y.obj==ue)&&(K.beginPath(),K.fillStyle=Y.obj==he?"#cccccc":"black",K.fillRect(0,I-Y.y+1,M/2+Y.x+V/2+1,Z-1),K.fillRect(M/2+Y.x-V/2-1,I-Y.y+1,M-(M/2+Y.x-V/2),Z-1),q&&K.fillRect(0,0,M,I-(I-Y.y)+3),j&&Y.obj!=he)){var ne=j.obj.i.height*j.s;K.fillRect(0,I-j.y+ne,M,I-Y.y-(I-j.y+ne)+2)}}}G||K.restore()}function x(e){var t=Q[e.color];return-1==e.direction&&(t=Z[e.color]),1==e.direction&&(t=V[e.color]),e.dead&&(t=_[e.color]),t}function S(){var e=x(X);K.drawImage(e.i,Math.floor(M/2-e.i.width/2)+.5,I-e.i.height-15)}function k(){K.beginPath(),K.save(),K.font="15px Arial Black",K.shadowColor="rgba(40,40,40,0.8)",K.fillStyle="#CCC",K.shadowOffsetX=1,K.shadowOffsetY=1,K.fillText("Speed: ",M/50,I/20,M/10),K.fillText("Lap: ",17*M/20,I/20,M/10),K.shadowColor="rgba(40,40,40,0.8)",K.shadowOffsetX=2,K.shadowOffsetY=2,K.font="20px Arial Black",K.fillStyle="white",K.fillText(Math.floor(200*X.speed/X.maxSpeed)+" kph",M/50,2*I/20),K.fillText(X.lap+" of "+F,17*M/20,2*I/20),K.restore()}function L(e,t,n){var i=$s("#"+e+" svg").cloneNode(!0);t&&t(i);var a=(new XMLSerializer).serializeToString(i),r="data:image/svg+xml;base64,"+btoa(a),o=new Image;o.addEventListener("load",function(){o.height=o.naturalHeight,o.width=o.naturalWidth;var e=n$("canvas");e.width=o.width,e.height=o.height;var t=e.getContext("2d");t.drawImage(o,0,0),n(e)}),o.setAttribute("src",r)}function E(e,t,n){for(var i=e.querySelectorAll("*[fill='"+t+"']"),a=0;a<i.length;a++)i[a].style.fill=n}function B(e,t){for(var n=0;n<t.length;n++)E(e,t[n][0],t[n][1])}function R(e){B(e,[["#f2f2f2","#00f200"],["#e6e6e6","#00e600"],["#cccccc","#00cc00"],["#b3b3b3","#00b300"]])}function O(e){B(e,[["#f2f2f2","#0000f2"],["#e6e6e6","#0000e6"],["#cccccc","#0000cc"],["#b3b3b3","#0000b3"]])}function P(e){B(e,[["#f2f2f2","#f20000"],["#e6e6e6","#e60000"],["#cccccc","#cc0000"],["#b3b3b3","#b30000"]])}function W(e){B(e,[["#f2f2f2","#f2f200"],["#e6e6e6","#e6e600"],["#cccccc","#cccc00"],["#b3b3b3","#b3b300"]])}function H(){b(),y(X.secIdx,X.zoff,X.x),S(),k()}function U(){b(),y(0,0,0);var e=n$("canvas");e.width=Y.width,e.height=Y.height;var t=e.getContext("2d");return t.drawImage(Y,0,0),e}function q(){J-=1,0>=J&&e()}function G(e){return{i:e,m:s(e)}}function N(e){e||(e="city"),ee=.5,te=.04/3,ne=.025,ie=.015,"city"==e?(ae=d("rgba(255,255,255,0)","rgba(255,255,255,0.25)",.25),re=i("#224400","#314430","white","white",ae),oe=i("#325611","#435443","#314430","#435443",ae),le=i("black","#314430","white","white"),ce=i("black","#435443","#314430","#435443"),se=h("blue","#325611",ae),we[ve.tree.id]=G(v("\ud83c\udf33",360,390,"darkgreen","#0E260E",8))):"desert"==e?(ae=d("rgba(237,204,169,0)","rgba(237,204,169,0.45)",.15),re=i("#E4BE9F","#C89B7E","#9C664C","#C89B7E",ae,function(e){a(e,"rgba(0,0,0,0)","#D3A281",ne)}),oe=i("#C89B7E","#D3A281","#9C664C","#D3A281",ae,function(e){a(e,"rgba(0,0,0,0)","#C89B7E",ne)}),le=i("black","#314430","white","white"),ce=i("black","#435443","#314430","#435443"),se=h("blue","#325611",ae),we[ve.tree.id]=G(v("\ud83c\udf35",300,260,"darkgreen","#0E260E",4))):"snow"==e&&(ae=d("rgba(255,255,255,0)","rgba(255,255,255,0.45)",.15),re=i("#C5D6FF","#ADBBE9","#9097B4","#ADBBE9",ae),oe=i("#EFE7F3","#CDCCD3","#9097B4","#CDCCD3",ae),le=i("black","#314430","white","white"),ce=i("black","#435443","#314430","#435443"),se=h("#5F6F90","#ADBBE9",ae),we[ve.tree.id]=G(v("\ud83c\udf32",300,260,"darkgreen","#0E260E",8))),we[ve.signSlip.id]=G(c(160,160,45,"yellow","black","\u26d0","black",.25)),we[ve.signWarn.id]=G(c(160,160,45,"white","black","\u26a0","red",.25)),we[ve.startLine.id]=G(l(ee*M*3*1.1,100,300,"red","red",.05,function(e){var t=65;e.font=t+"px 'Arial Black'",e.textAlign="center",e.fillStyle="white",e.fillText("\ud83c\udfc1 START \ud83c\udfc1",ee*M*3*1.1/2,50+t/4)})),we[ve.checkpoint.id]=G(l(ee*M*3*1.1,100,300,"white","white",.05,function(e){var t=65;e.font=t+"px 'Arial Black'",e.textAlign="center",e.fillStyle="black",e.fillText("\ud83d\udd53 CHECKPOINT \ud83d\udd53",ee*M*3*1.1/2,50+t/4)})),we[ve.tunnelLight.id]={i:o()},we[ve.reverser.id]=G(w("\u21b7",ee*T*.25,ee*T*.25,"rgba(245,242,83,0.2)","white")),we[ve.boost.id]=G(w("\ud83d\ude80",ee*T*ve.boost.width,ee*T*ve.boost.width,"rgba(255,255,255,0)","orange")),fe={i:r()},he={i:r(!0)},ue={i:r(!1,!0)},de=f(ae)}var Y=$("c"),K=Y.getContext("2d");Y.width=M,Y.height=I,K.fontsize=15,K.translate(.5,.5);var J=0,Q={},V={},Z={},_={};[["red",P],["green",R],["blue",O],["grey",null],["yellow",W]].forEach(function(e){J++,L("cr",e[1],function(t){Q[e[0]]=G(t),_[e[0]]=G(u(t,.2)),q()}),J++,L("crt",e[1],function(t){V[e[0]]=G(t),Z[e[0]]=G(p(t)),q()})});var ee,te,ne,ie,ae,re,oe,le,ce,se,de,fe,he,ue,pe=I/2,ge=g(pe),ve=C.objs,we={};return{render:H,setType:N,getSnapshot:U,carImgs:Q}}function r(e,t){var n=A.sections[e.secIdx].direction();return n*e.turnSpeed*(Math.pow(Math.min(e.speed,e.maxSpeed),3)/Math.pow(e.maxSpeed,3))*t*-1}function o(e,t,n){var i=A.normalizeSection(e.secIdx,e.zoff+t),a=g(i.s,i.o,n,e);return a&&(a.obj.isCar||a.obj[2].bump)?a:!1}function l(e,t){if(!e.dead){e.accelerating?e.speed=e.speed+t*e.acceleration*(1-Math.pow(Math.abs(e.speed),1)/Math.pow(e.maxSpeed,1)):e.braking?e.speed=Math.max(e.speed-t*e.acceleration*(1+Math.pow(e.speed,2)/Math.pow(e.maxSpeed,2)),-1*e.maxSpeed/3):e.speed=e.speed>0?Math.max(e.speed-t*e.acceleration/3,0):Math.min(e.speed+t*e.acceleration/3,0);var n=0;0!=e.direction&&(n=(e.reversed?1:-1)*e.direction*e.turnSpeed*(Math.min(e.speed,e.maxSpeed)/e.maxSpeed)*t)}var i=e.zoff;if(e.zoff=i+e.speed*t,e.dead&&e.secIdx==e.lastCheckpointSection){if(e.zoff<=e.lastCheckpointOffset||i<=e.lastCheckpointOffset){e.zoff=e.lastCheckpointOffset,e.speed=0;var a=p(e);if(a)return;return void(e.dead=!1)}e.speed=(e.zoff-e.lastCheckpointOffset)/A.sections[e.secIdx].len()*e.maxSpeed*2*-1-e.maxSpeed/20}var l=A.normalizeSection(e.secIdx,e.zoff);0==l.s&&e.secIdx==A.sections.length-1&&e.lap++,e.secIdx=l.s,e.zoff=l.o;var c=r(e,t);if(!e.dead)if(e.ai){e.x==e.destinationX&&(e.destinationX=void 0);var s=e.turnSpeed,d=z/2+z*(e.speed/e.maxSpeed),f=o(e,d,e.x);if(f){var h=f.obj.isCar?.4:f.obj[2].width;e.destinationX=e.x+f.dvx,(e.destinationX<-.75||e.destinationX>.75||o(e,d/2,e.destinationX))&&(e.destinationX=e.x+(f.dvx>0?-h:h)+(f.dvx+(f>0?-h:h)),(e.destinationX<-.75||e.destinationX>.75||o(e,d/2,e.destinationX))&&(e.destinationX=void 0,e.accelerating=!1,e.braking=!0))}else e.braking=!1,e.accelerating=!0;if(void 0!==e.destinationX){var u=Math.min(Math.abs(e.destinationX-e.x),s);e.destinationX<e.x?e.x=e.x-u*t:e.x=e.x+u*t}}else e.x=Math.max(Math.min(e.x+n-c,1),-1);if(!e.dead&&0!=e.speed){var g=p(e);if(g){var v=g.obj;if(v.isCar)e.dead=!0,e.speed=-1*e.maxSpeed*5,e.x=1.5*Math.random()-.75,e.destinationX=void 0;else if(v[2].id==C.objs.boost.id)e.speed=1.1*e.speed,v[2]=C.objs.disabledItem,setTimeout(function(){v[2]=C.objs.boost},L);else if(v[2].id==C.objs.checkpoint.id||v[2].id==C.objs.startLine.id){var w=A.normalizeSection(e.secIdx,v[0]-z);e.lastCheckpointSection=w.s,e.lastCheckpointOffset=w.o}else{e.x=e.x+1.1*g.dvx,e.zoff=e.zoff+g.dvy;var b=A.normalizeSection(e.secIdx,e.zoff);e.secIdx=b.s,e.zoff=b.o,e.speed=.9*e.speed}}}}function c(e){for(var t=0;t<D.length;t++)l(D[t],e)}function s(e,t){if(e.lap<t.lap)return!0;if(e.lap==t.lap){if(e.secIdx<t.secIdx)return!0;if(e.secIdx==t.secIdx&&e.zoff<t.zoff)return!0}return!1}function d(e){for(var t=1,n=0;n<D.length;n++)e!=D[n]&&s(e,D[n])&&(t+=1);return e!=X&&s(e,X)&&(t+=1),t}function f(e){if(!W){S||(S=e);var t=e-S,n=t/P;if(S=e,v(),l(X,n),!X.ai&&X.lap>F){var i=(performance.now()-k)/1e3,a=Math.floor(i/60),o=i-60*a;X.ai=!0,X.accelerating=!0,D.push(X),$("finished").style.display="block",$("time").innerHTML=a+"m "+o.toFixed(2)+"s",$("laps").innerHTML=F,$("pos").innerHTML=d(X)+" of "+D.length}c(n),j=(j+-1*r(X,n)*(T/3)/3)%T,O.render(),requestAnimationFrame(f)}}function h(e){for(var t=[],n=0;e>n;n++){var a=i(-3/4+(n%4>1?.5:0)+n%2,0,Math.floor(n/2)*(z/2),"grey",.0015*Math.random()+.0035,.065,Math.random()*(.75-.6)+.6);a.ai=!0,a.accelerating=!0,t.push(a)}return t}function u(e,t,n,i,a,r,o){var l=0,c=0,s=!1,d=!1;i>=e&&e+z/2>=i&&(l=-1*(e+z/2-i),d=!0);var f=t-n/2,h=t+n/2,u=a-r/2,p=a+r/2;return p>f&&h>u&&(c=Math.abs(p-f)<Math.abs(h-u)?p-f:-1*(h-u),s=!0),s&&d?{dvx:c,dvy:l,obj:o}:null}function p(e){return g(e.secIdx,e.zoff,e.x,e)}function g(e,n,i,a){var r,o=.4,l=n,c=i,s=o;if(r=t(D,function(t){return t!=a&&!t.dead&&t.secIdx==e&&u(l,c,s,t.zoff,t.x,.25,t)}),a==X||e!=X.secIdx||X.dead||(r=u(l,c,s,X.zoff,X.x,o,X)),r)return r;var d=A.sections[e];return r=t(d.objects,function(e){return e[2].width&&e[2].id!=C.objs.disabledItem&&u(l,c,s,e[0],e[1],e[2].width,e)})}function v(){X.direction=0,R.Right&&(X.direction=1),R.Left&&(X.direction=-1),R.Up&&(X.accelerating=!0,X.braking=!1),R.Down&&(X.accelerating=!1,X.braking=!0),R.Down||R.Up||(X.braking=!1,X.accelerating=!1)}function w(){document.removeEventListener("keyup",b),document.removeEventListener("keydown",m),W=!0}function b(e){var t=e.key||e.keyIdentifier;R[t]=!1}function m(e){var t=e.key||e.keyIdentifier;return R[t]=!0,e.preventDefault(),!1}function y(e,t,n){O.setType(n),X=i(-.75,B.s,B.o,e,.005,.0208,.8),F=t,document.addEventListener("keyup",b),document.addEventListener("keydown",m),D=h(E),O.render();var a=$s(".countdown");$s(".countdown").style.display="block";var r=a.cloneNode(!0);a.parentNode.replaceChild(r,a),window.setTimeout(function(){$s(".countdown").style.display="none",k=performance.now(),W=!1,requestAnimationFrame(f)},4100)}var x=function(e,t,n,i,a){this.cornerType=e,this.segmentCount=t,this.objects=n,this.hillType=i,this.isTunnel=a};x.prototype.direction=function(){var e=this.cornerType;return 0==e?0:e/Math.abs(e)},x.prototype.len=function(){return this.segmentCount*z};var C=function(e){this.sections=e};C.prototype.sectionFromOffset=function(e,t){return this.normalizeSection(e,t).s},C.prototype.normalizeSection=function(e,t){for(;;){var n=this.sections[e];if(t>n.len())t-=n.len(),e++,e>=this.sections.length&&(e=0);else{if(!(0>t))return{s:e,o:t};e--,0>e&&(e=this.sections.length-1),t=this.sections[e].len()+t}}},C.objs={signSlip:{id:0,width:.5,bump:!0},signWarn:{id:1,width:.5,bump:!0},tree:{id:2,width:.15,bump:!0},tunnelLight:{id:3},checkpoint:{id:4,width:2},reverser:{id:5,width:.2,item:!0},disabledItem:{id:6},boost:{id:7,width:.125,item:!0},startLine:{id:8,width:2}},C.cornerTypes={left:-2,right:2,straight:0},C.hillTypes={flat:0,down:.005,up:-.005};var S,k,M=640,I=400,T=3*M,z=5,j=0,L=2e3,A=n(),E=40,B=A.normalizeSection(0,-1*z),D={},X=i(-.75,B.s,B.o,"red",.005,.0208,.8),R={},O=a(),P=1e3/60,F=10,W=!1;return{start:y,renderer:O,stop:w}}function playMusic(){audio.play(),audio.loop=!0}function stopMusic(){audio.pause()}function main(){state.g=game(function(){var e=state.g;e.renderer.setType("city");var t=e.renderer.getSnapshot();e.renderer.setType("desert");var n=e.renderer.getSnapshot();e.renderer.setType("snow");var i=e.renderer.getSnapshot();$s("#colorRed + label").appendChild(e.renderer.carImgs.red.i),$s("#colorGreen + label").appendChild(e.renderer.carImgs.green.i),$s("#colorBlue + label").appendChild(e.renderer.carImgs.blue.i),$s("#colorYellow + label").appendChild(e.renderer.carImgs.yellow.i),$s("#typecity + label").appendChild(t),$s("#typedesert + label").appendChild(n),$s("#typesnow + label").appendChild(i),$s(".menu").style.display="block",$("loader").style.display="none";var a=$("toggleMusic");a.addEventListener("click",function(){var e=a.classList;e.contains("muted")?(playMusic(),e.remove("muted")):(e.add("muted"),stopMusic())})})}function startGame(){var e=$s("input[name='color']:checked").value,t=parseInt($s("input[name='laps']:checked").value),n=$s("input[name='type']:checked").value;console.log(e,t,n),state.g.start(e,t,n),$s(".menu").style.display="none",$("toggleMusic").classList.contains("muted")||playMusic()}function restartGame(){state.g.stop(),$("finished").style.display="none",$("loader").style.display="block",state.g=game(function(){$("loader").style.display="none",$s(".menu").style.display="block"})}function resize(){var e=$s(".gs");"960px"!=e.style.width?(e.style.width="960px",e.style.height="600px"):(e.style.width="640px",e.style.height="400px")}var CPlayer=function(){var e,t,n,i,a,r=function(e){return Math.sin(6.283184*e)},o=function(e){return 2*(e%1)-1},l=function(e){return.5>e%1?1:-1},c=function(e){var t=e%1*4;return 2>t?t-1:3-t},s=function(e){return.003959503758*Math.pow(2,(e-128)/12)},d=function(e,t,n){var i,a,r,o,l,c,d,h=f[e.i[0]],u=e.i[1],p=e.i[3],g=f[e.i[4]],v=e.i[5],w=e.i[8],b=e.i[9],m=e.i[10]*e.i[10]*4,y=e.i[11]*e.i[11]*4,x=e.i[12]*e.i[12]*4,C=1/x,S=e.i[13],k=n*Math.pow(2,2-e.i[14]),M=new Int32Array(m+y+x),I=0,T=0;for(i=0,a=0;m+y+x>i;i++,a++)a>=0&&(S=S>>8|(255&S)<<4,a-=k,c=s(t+(15&S)+e.i[2]-128),d=s(t+(15&S)+e.i[6]-128)*(1+8e-4*e.i[7])),r=1,m>i?r=i/m:i>=m+y&&(r-=(i-m-y)*C),o=c,p&&(o*=r*r),I+=o,l=h(I)*u,o=d,w&&(o*=r*r),T+=o,l+=g(T)*v,b&&(l+=(2*Math.random()-1)*b),M[i]=80*l*r|0;return M},f=[r,l,o,c];this.init=function(r){e=r,t=r.endPattern-2,n=0,i=r.rowLen*r.patternLen*(t+1)*2,a=new Int32Array(i)},this.generate=function(){var o,l,c,s,h,u,p,g,v,w,b,m,y,x,C=new Int32Array(i),S=e.songData[n],k=e.rowLen,M=e.patternLen,I=0,T=0,$=!1,z=[];for(c=0;t>=c;++c)for(p=S.p[c],s=0;M>s;++s){var j=p?S.c[p-1].f[s]:0;j&&(S.i[j-1]=S.c[p-1].f[s+M]||0,15>j&&(z=[]));var L=f[S.i[15]],A=S.i[16]/512,E=Math.pow(2,S.i[17]-9)/k,B=S.i[18],D=S.i[19],X=43.23529*S.i[20]*3.141592/44100,R=1-S.i[21]/255,O=1e-5*S.i[22],P=S.i[23]/32,F=S.i[24]/512,W=6.283184*Math.pow(2,S.i[25]-9)/k,H=S.i[26]/255,U=S.i[27]*k;for(b=(c*M+s)*k,h=0;4>h;++h)if(u=p?S.c[p-1].n[s+h*M]:0){z[u]||(z[u]=d(S,u,k));var q=z[u];for(l=0,o=2*b;l<q.length;l++,o+=2)C[o]+=q[l]}for(l=0;k>l;l++)g=2*(b+l),w=C[g],w||$?(m=X,B&&(m*=L(E*g)*A+.5),m=1.5*Math.sin(m),I+=m*T,y=R*(w-T)-I,T+=m*y,w=3==D?T:1==D?y:I,O&&(w*=O,w=1>w?w>-1?r(.25*w):-1:1,w/=O),w*=P,$=w*w>1e-5,v=Math.sin(W*g)*F+.5,x=w*(1-v),w*=v):x=0,g>=U&&(x+=C[g-U+1]*H,w+=C[g-U]*H),C[g]=0|x,C[g+1]=0|w,a[g]+=0|x,a[g+1]+=0|w}return n++,n/8},this.createWave=function(){var e=2*i-8,t=e-36,n=44,r=new Uint8Array(n+2*i);r.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var o=0,l=n;i>o;++o){var c=a[o];c=-32767>c?-32767:c>32767?32767:c,r[l++]=255&c,r[l++]=c>>8&255}return r},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),i=new Array(t),r=0;2*t>r;r+=1){var o=n+r;i[r]=e>0&&o<a.length?a[o]/32768:0}return i}},song={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1,1,1,1,1,1,1,1,1,1,,,,,1,1,1],c:[{n:[149,,149,,,,,,156,,156,,,,,,147,,147,,,,,,151,151,151],f:[]}]},{i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,,,,1,1,1,1,1,,,,,1,1,1,1],c:[{n:[,171,171,,,176,,,,171,171,,,176,,,,171,171,,,176,,,,171,171,,,176],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[,,,,,,1,1,1,1,1,,,,,1,1],c:[{n:[144,,,144,,,,,152,,,152,,,,,120,,,120,,,,,128,,,128],f:[]}]},{i:[2,255,128,0,3,255,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],p:[,,,,,,,2,2,2,2,2,,,,,2,2],c:[{n:[152,,,,151,,,,164,,,,163,,,,159,,,,154,,,,166,,,,163],f:[]},{n:[156,,,,,,139,142,146,,,,,,,,,,149,,,,156,,,151,,,154,,,,,141,147,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146,151,151],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:5513,patternLen:32,endPattern:19},audio=document.createElement("audio"),musicplayer=new CPlayer;for(musicplayer.init(song);musicplayer.generate()<1;);var wave=musicplayer.createWave();audio.src=URL.createObjectURL(new Blob([wave],{type:"audio/wav"}));var state={g:null};window.addEventListener("load",main,!1);