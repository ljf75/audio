<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>Ballarena Revival</title>
		<meta charset="utf-8">
		<style type="text/css">
html,body {
	height:100%;
}
div {
  float: left;
  width:  100%;
  min-height:100%;
  height:100%;
  margin: 0px;
  background-color : black;
}

table {
	width:100%;
	height:100%;
}
canvas {
	position:absolute;
}
		</style>
	</head>
	<body>
		<div id="d">
		<canvas id="c"></canvas>
			<table>
				<tr><td id="e"></td><td id="f"></td><td id="g"></td></tr>
		</table>
		</div>
		<script>
function AdvancedRenderer(a,d,e){this.context=a.getContext("2d");this.canvas=a;this.container=d;this.game=e;this.itemTime=this.itemDisplayed=this.time=0;this.menuText=["PLAY ! ","CONTROLS : ","MUSIC : ","SOUND FX : ","HALL OF FAME"];this.starfield=[];for(a=0;500>a;++a)this.starfield[a]=[Math.random(),Math.random(),Math.random()];this.starfieldPhi=this.starfieldZ=this.starfieldY=this.starfieldX=0;this.starfieldSpeed=[0,0,-0.005,0.01];this.starfieldTargetSpeed=[0,0,-0.005,0.01];this.starfieldTargetCount= this.starfieldCount=100;this.twirlingStars=[];this.floaterSymbol=" \u21d4 >< \u271a \u2665 \u273f \u2615 \u2620 \u270b \u2638 \u272a \u26a1 \u269b \u2668".split(" ");this.floaterColor=" #CFC #FE8 #CFC #FCC #CCC #CCF #FFF #FFC #FEC #DEE #8FF #8F8 #FFC".split(" ");this.meteors=[]} AdvancedRenderer.prototype={initialize:function(){this.renderBuffer=document.createElement("canvas");this.renderBuffer.width=1060;this.renderBuffer.height=580;var a=this.renderBuffer.getContext("2d"),d="#FFFFC0 #FFFFC0 #FFFFC0 #C0FFC0 #C0FFFF #FFC0FF #FFC0FF #FFC0FF #FFFFFF #AAA".split(" "),e="#FF2000 #E08000 #C0C000 #00A000 #0080C0 #0020FF #7000C0 #FF00A0 #404040 #000".split(" ");a.save();for(var f=0;10>f;++f){var g=a.createRadialGradient(15,45,2,30,30,30);g.addColorStop(0,d[f]);g.addColorStop(1, e[f]);a.fillStyle=g;a.beginPath();a.arc(30,30,30,0,7,0);a.fill();a.translate(0,60);for(var h=1;8>h;++h){a.strokeStyle=g;a.lineWidth=26-3*h;for(var l=(8.5-h)/8,k=0;8>k;++k)a.beginPath(),a.arc(30,30,17,(k-l)*Math.PI/4,(k+l)*Math.PI/4,0),a.stroke();a.translate(0,60)}a.translate(60,-480)}a.restore();a.save();a.translate(600,0);g=a.createRadialGradient(30,30,2,30,30,30);g.addColorStop(0,"rgba(0,0,0,0)");g.addColorStop(0.7,"rgba(0,0,0,0)");g.addColorStop(0.8,"#0000FF");g.addColorStop(0.85,"#00FFFF");g.addColorStop(1, "rgba(0,0,255,0)");a.fillStyle=g;a.beginPath();a.arc(30,30,30,0,7,0);a.fill();a.translate(0,60);g=a.createRadialGradient(8,23,2,15,15,15);g.addColorStop(0,"white");g.addColorStop(1,"#202030");a.fillStyle=g;a.beginPath();a.arc(15,15,15,0,7,0);a.fill();a.translate(0,60);g=a.createRadialGradient(8,23,2,15,15,15);g.addColorStop(0,"white");g.addColorStop(1,"red");a.fillStyle=g;a.beginPath();a.arc(15,15,15,0,7,0);a.fill();a.translate(0,60);a.beginPath();a.arc(15,15,15,0,7,0);a.fill();a.translate(0,-60); g=a.createLinearGradient(0,0,30,0);g.addColorStop(0,"#FF0000");g.addColorStop(0.1,"#00A000");g.addColorStop(0.3,"#A0FFA0");g.addColorStop(0.9,"#00A000");g.addColorStop(1,"#FF0000");a.fillStyle=g;a.fillRect(0,15,30,60);a.restore();a.textAlign="center";a.textBaseline="middle";a.fillStyle="yellow";a.font="20px Verdana";d="1990 ProTracker module.;for the original;Horace Wimp of Aurora;;and music.;used for both sfx;the amazing SoundBox Lite;Marcus Geelnard for;;version go as follow :;Credits for this;;Acorn Archimedes.;by Eterna on;released in 1990;original Ballarena;tribute to the;This game is a;;;again for next compo.;and meet you;enjoyed the game,;Hope you;;Ballarena 2013k;You just completed;Congratulations !".split(";"); for(e=0;e<d.length;++e)a.fillText(d[e],860,20+20*e)},resize:function(){var a=Math.min(window.innerWidth,window.innerHeight);this.canvas.height=this.canvas.width=a;this.context.height=this.context.width=a;this.context.translate(a/2,a/2);this.context.scale(0.4*a,-0.4*a);this.canvas.style.left=Math.floor((window.innerWidth-a)/2)+"px";this.canvas.style.top=Math.floor((window.innerHeight-a)/2)+"px"},drawMain:function(){this.context.save();this.context.clearRect(0,0,this.context.width,this.context.height); this.resize();this.drawStarfield();if(2==this.game.eventType){if(0==this.twirlingStars.length){for(var a=0;a<this.starfieldCount;++a){var d=this.starfield[a][0]+this.starfieldX,e=this.starfield[a][1]+this.starfieldY,f=this.starfield[a][2]+this.starfieldZ,d=d-Math.floor(d)-0.5,e=e-Math.floor(e)-0.5,f=f-Math.floor(f)+0.5;if(d*d+e*e<f*f){var g=d*Math.cos(this.starfieldPhi)-e*Math.sin(this.starfieldPhi),d=e*Math.cos(this.starfieldPhi)+d*Math.sin(this.starfieldPhi);this.twirlingStars.push([2*g/f,2*d/f, 0.005/f])}}this.starfieldCount=0}this.context.save();a=Math.cos(this.game.level.padAngle[0])*(this.game.level.padRadius-0.04);f=Math.sin(this.game.level.padAngle[0])*(this.game.level.padRadius-0.04);this.context.translate(a*(50-this.game.transitionTimer)/50,f*(50-this.game.transitionTimer)/50);f=(1+this.game.transitionTimer)/51;this.context.scale(f,f);for(a=0;a<this.twirlingStars.length;++a)this.context.fillRect(this.twirlingStars[a][0],this.twirlingStars[a][1],this.twirlingStars[a][2]/f,this.twirlingStars[a][2]/ f);this.context.restore()}else this.twirlingStars.length=0;this.game.transitionToHof?(this.context.save(),this.context.translate(2-this.game.transitionToHof/5,0),this.drawHallOfFame(),this.context.restore()):this.time=0;10>this.game.transitionToHof&&14>this.game.level.level&&(this.context.save(),this.context.translate(-this.game.transitionToHof/5,0),this.drawGame(),this.context.restore());3==this.game.eventType&&this.game.transitionTimer&&(this.context.save(),this.context.scale(0.01,-0.01),this.context.fillStyle= "black",this.context.strokeStyle="white",this.context.font="64px Verdana",this.context.textAlign="center",this.context.textBaseline="middle",d=0.09*(this.game.transitionTimer-50)*(this.game.transitionTimer-50)-20,this.context.fillText("GAME",-d,-30),this.context.strokeText("GAME",-d,-30),this.context.fillText("OVER",d,30),this.context.strokeText("OVER",d,30),this.context.restore());if(10>this.game.menuOffset){a=this.game.level.time;f=Math.round(215-Math.cos(a/20));f="rgb("+f+",255,"+(430-f)+")";0== a%3&&0==(Math.floor(a/50)&1)&&(f="#FF8080");this.context.translate(this.game.menuOffset/5,0);this.context.scale(0.012,-0.012);this.context.textAlign="center";this.context.fillStyle="black";this.context.lineWidth=1.5;this.context.lineJoin="bevel";for(a=0;5>a;++a)this.context.strokeStyle=this.game.menu.selectedOption==a?f:"#A0A0A0",g=this.menuText[a],this.game.level.level&&(g=4==a?"QUIT":!a?"RESUME":g),g+=1==a?1==this.game.controls.stance?"REGULAR":"GOOFY":"",g+=2==a?this.game.level.soundManager.soundSupport? this.game.level.soundManager.musicOn?"ON":"OFF":"not supported":"",g+=3==a?this.game.level.soundManager.soundSupport?this.game.level.soundManager.soundOn?"ON":"OFF":"not supported":"",this.context.strokeText(g,0,25*a-50),this.context.fillText(g,0,25*a-50)}this.context.restore()},drawEndGame:function(){this.context.save();this.context.clearRect(0,0,this.context.width,this.context.height);this.resize();this.drawStarfield();for(var a=580,d=-1.25;0.5>d;d+=0.01){var e=Math.min(580,Math.max(0,930-200*(-1/ (d-1))-this.time%850)),f=a-Math.floor(e);0==this.time%850?a=580:0<f&&(this.context.globalAlpha=0.5-d/2,this.context.drawImage(this.renderBuffer,660,e,400,1,-1+d,d,2-2*d,0.01),a=Math.min(a,Math.ceil(e)))}this.context.restore();++this.time},drawGame:function(){var a=this.game.level;this.context.rotate(-a.cameraRoll);this.context.textAlign="center";this.context.textBaseline="middle";for(var d=0;d<a.floaters.length;++d){this.context.save();this.context.translate(a.floaters[d].posX,a.floaters[d].posY); this.context.drawImage(this.renderBuffer,600,0,60,60,-a.floaters[d].radius,-a.floaters[d].radius,2*a.floaters[d].radius,2*a.floaters[d].radius);var e=0.01+0.002*Math.sin(a.time/5);this.context.scale(e,-e);this.context.fillStyle=this.floaterColor[a.floaters[d].item];this.context.fillText(this.floaterSymbol[a.floaters[d].item],0,0.5);this.context.restore();a.floaters[d].hit&&this.meteors.push({x:a.floaters[d].posX,y:a.floaters[d].posY,i:a.floaters[d].item,t:0,r:a.floaters[d].radius})}for(d=0;d<a.bricks.length;++d)e= a.bricks[d].alive?0:a.time-a.bricks[d].timeBlown,8>e&&this.context.drawImage(this.renderBuffer,60*a.bricks[d].color,60*e,60,60,a.bricks[d].posX-a.bricks[d].radius,a.bricks[d].posY-a.bricks[d].radius,2*a.bricks[d].radius,2*a.bricks[d].radius),a.bricks[d].hitEcho&&(this.context.beginPath(),this.context.arc(a.bricks[d].posX,a.bricks[d].posY,a.bricks[d].radius,0,7,0),this.context.fill());for(d=0;d<this.meteors.length;++d)if(50<this.meteors[d].t)this.meteors[d]=this.meteors[this.meteors.length-1],--this.meteors.length, --d;else{e=this.meteors[d].r*(50-this.meteors[d].t)/50;this.context.save();this.context.lineWidth=0.01;this.context.translate(this.meteors[d].x,this.meteors[d].y);this.context.rotate(++this.meteors[d].t/10);this.context.strokeStyle="blue";this.context.beginPath();this.context.arc(0,0,0.95*e,0,7,0);this.context.stroke();this.context.fillStyle=7==this.meteors[d].i?"red":"white";this.context.beginPath();this.context.moveTo(e,0);for(var f=0;9>f;++f)this.context.lineTo((f&1?e/4:e)*Math.cos(f*Math.PI/4), (f&1?e/4:e)*Math.sin(f*Math.PI/4));this.context.fill();this.context.restore()}if(1!=this.game.eventType)for(d=0;d<a.ballsInPlay;++d)this.context.drawImage(this.renderBuffer,600,60,30,30,a.balls[d].posX-a.balls[d].radius,a.balls[d].posY-a.balls[d].radius,2*a.balls[d].radius,2*a.balls[d].radius);if(a.level){this.context.rotate(a.cameraRoll);this.context.save();this.context.scale(0.01,-0.01);if(a.newItem&&(a.lastItem!=this.itemDisplayed||115<=this.itemTime))this.itemDisplayed=a.lastItem,this.itemTime= 0,this.predrawItemName(0);this.itemDisplayed&&60>this.itemTime&&(d=-120+(15<this.itemTime?0:0.3*(this.itemTime-15)*(this.itemTime-15)),e=Math.min(240,120-d),15<this.itemTime&&30>this.itemTime?this.predrawItemName(this.itemTime-15):50<=this.itemTime&&this.predrawItemNameHide(this.itemTime-50),this.context.drawImage(this.renderBuffer,0,480,2.5*e,100,d,-130,e,40),++this.itemTime);this.context.rotate(Math.PI/2);for(d=0;d<a.lives;++d)this.context.drawImage(this.renderBuffer,600,120,30,30,-85+10*d,90,5, 5),this.context.drawImage(this.renderBuffer,600,150,30,30,-85+10*d,95,5,10),this.context.drawImage(this.renderBuffer,600,180,30,30,-85+10*d,105,5,5);this.context.rotate(-Math.PI/2);this.context.fillStyle="white";this.context.fillText(a.score,-100,80);this.context.fillStyle="blue";d=13==a.level?"\u2169\u2162":String.fromCharCode(8543+a.level);1==this.game.eventType&&this.game.transitionTimer?(this.context.translate(80-3*this.game.transitionTimer,-80+5*this.game.transitionTimer),e=1+this.game.transitionTimer/ 10,this.context.scale(e,e),this.context.fillText("level",0,-this.game.transitionTimer/e-300/(3+this.game.transitionTimer)),this.context.fillText(d,0,0),this.context.lineWidth=0.3,this.context.strokeStyle="rgb(0,"+Math.min(255,4*this.game.transitionTimer)+",255)",this.context.strokeText("level",0,-this.game.transitionTimer/e-300/(3+this.game.transitionTimer)),this.context.strokeText(d,0,0)):this.context.fillText(d,80,-80);this.context.restore();if(a.environmentItem){this.context.strokeStyle="red"; this.context.lineWidth=0.02;for(d=0;12.5*d<a.environmentItemEnd-a.time;++d)this.context.beginPath(),this.context.arc(0,0,1,Math.PI/2-Math.PI*d/12,Math.PI/2-Math.PI*(d/12+1/13),!0),this.context.stroke()}if(1!=this.game.eventType){this.context.rotate(-a.cameraRoll);for(d=0;d<a.padCount;++d)this.context.rotate(a.padAngle[d]),this.context.drawImage(this.renderBuffer,600,120,30,30,a.padRadius,-a.padWidth,a.padThickness,a.padThickness),this.context.drawImage(this.renderBuffer,600,150,30,30,a.padRadius, -a.padWidth+a.padThickness,a.padThickness,2*(a.padWidth-a.padThickness)),this.context.drawImage(this.renderBuffer,600,180,30,30,a.padRadius,a.padWidth-a.padThickness,a.padThickness,a.padThickness)}}},predrawItemName:function(a){var d=this.renderBuffer.getContext("2d");a||d.clearRect(0,480,600,100);d.globalCompositeOperation="lighter";d.font="64px Verdana";d.strokeStyle="rgba(16, 64, 16, 64)";d.strokeText(";LARGER PAD;SMALLER PAD;EXTRA PAD;LIFE;MULTI BALL;SLOW DOWN BALLS;POISON;SLOW DOWN PADS;;;;;;;;CAMERA ROLL;STEEL BRICKS;MAGNETIC;GRAVITY;STICKY PADS".split(";")[this.itemDisplayed], 300-a,530)},predrawItemNameHide:function(a){for(var d=this.renderBuffer.getContext("2d"),e=0;10>e;++e)d.clearRect(0,480+10*e+a,600,1)},drawStarfield:function(){var a=this.game.level.level;this.context.fillStyle="white";this.context.rotate(this.starfieldPhi);for(var d=0;d<this.starfieldCount;++d){var e=this.starfield[d][0]+this.starfieldX,f=this.starfield[d][1]+this.starfieldY,g=this.starfield[d][2]+this.starfieldZ,e=e-Math.floor(e)-0.5,f=f-Math.floor(f)-0.5,g=g-Math.floor(g)+0.5;this.context.fillRect(2* e/g,2*f/g,0.005/g,0.005/g)}this.context.rotate(-this.starfieldPhi);this.starfieldTargetSpeed[0]=[0,0.01,0,-0.01][a&3];this.starfieldTargetSpeed[1]=[0,0,-0.01,0.01,0,0][a%6];this.starfieldTargetSpeed[2]=[-0.005,0,-0.005,0,0,-0.01,-0.02,0][a&7];this.starfieldTargetSpeed[3]=[0.01,0,0,0,-0.008][a%4];this.starfieldTargetCount=a?100:500==this.starfieldTargetCount?100:100==this.starfieldTargetCount?500:this.starfieldTargetCount;this.starfieldX+=this.starfieldSpeed[0];this.starfieldY+=this.starfieldSpeed[1]; this.starfieldZ+=this.starfieldSpeed[2];this.starfieldPhi+=this.starfieldSpeed[3];for(d=0;4>d;++d)a=this.starfieldTargetSpeed[d]-this.starfieldSpeed[d],this.starfieldSpeed[d]+=1E-4>Math.abs(a)?0:0<a?1E-4:-1E-4;this.starfieldCount+=this.starfieldTargetCount==this.starfieldCount?0:this.starfieldTargetCount>this.starfieldCount?1:-1},drawHallOfFame:function(){this.context.scale(0.025,-0.025);this.context.textAlign="center";this.context.lineWidth=0.3;for(var a=15;0<a;--a)this.context.strokeStyle="rgb("+ (255-17*a)+","+(255-17*a)+","+(255-17*a)+")",this.context.strokeText("Hall of Fame",0.2*a*Math.cos(-a+this.time),-a/3-35);this.context.fillStyle="black";this.context.fillText("Hall of Fame",0,-35);-1<this.game.signingToHof?this.time=(8*this.time+30*this.game.signingToHof)/9:++this.time;this.context.scale(0.4,0.4);this.context.rotate(-0.01*this.time);this.context.textBaseline="middle";for(a=0;16>a;++a)this.context.fillStyle="rgb("+(255-17*a)+","+17*a+","+(a==this.game.signingToHof?255:0)+")",this.context.textAlign= "left",this.context.font="6px Verdana",this.context.fillText(1+a+".",18,0),this.context.font="7px Verdana",this.context.scale(1,1.5),this.context.fillText(this.game.hof[a][0],30,0),this.context.textAlign="right",this.context.scale(1,1.7),this.context.fillText(this.game.hof[a][1],86,0),this.context.scale(1,1/2.55),this.context.rotate(0.3)}};function Ball(a){this.posY=this.posX=0;this.speed=0.02;this.heading=0;this.radius=0.04;this.stuckOnPad=a;this.offsetOnPad=0}Ball.prototype={}; function Brick(a,d,e){this.hitPoints=1;this.relativeTime=0;this.posX=a;this.posY=d;this.radius=0.08;this.alive=!0;this.timeBlown=0;this.path=null;this.color=e;this.value=this.hitPoints}Brick.prototype={moveTo:function(a,d){this.posX=a;this.posY=d},receiveHit:function(a){--this.hitPoints?++this.color:this.explode(a);return!this.hitPoints},explode:function(a){this.alive=!1;this.timeBlown=a}};function CircularPath(a,d){this.radius=a;this.speed=d} CircularPath.prototype={positionAt:function(a){return{x:this.radius*Math.cos(this.speed*a),y:this.radius*Math.sin(this.speed*a)}}};function DoubleCircularPath(a,d,e,f){this.radius=a;this.speed=d;this.radius2=e;this.speed2=f}DoubleCircularPath.prototype={positionAt:function(a){return{x:this.radius*Math.cos(this.speed*a)+this.radius2*Math.cos(this.speed2*a),y:this.radius*Math.sin(this.speed*a)+this.radius2*Math.sin(this.speed2*a)}}}; function HarmonicPath(a,d,e,f){this.radius=a;this.speed=d;this.radius2=e;this.speed2=f}HarmonicPath.prototype={positionAt:function(a){return{x:(this.radius+this.radius2*Math.cos(this.speed2*a))*Math.cos(this.speed*a),y:(this.radius+this.radius2*Math.cos(this.speed2*a))*Math.sin(this.speed*a)}}};function OscillatingPath(a,d,e,f,g,h){this.deltaX=a;this.radiusX=d;this.offsetY=e;this.speed1=f;this.speed2=g;this.shift2=h} OscillatingPath.prototype={positionAt:function(a){var d=this.speed1*a,a=this.deltaX+this.radiusX*Math.cos(this.speed2*a+this.shift2);return{x:a*Math.cos(d)-this.offsetY*Math.sin(d),y:a*Math.sin(d)+this.offsetY*Math.cos(d)}}};function FlowerPath(a,d,e,f){this.coefA=a;this.coefB=d;this.coefC=e;this.speed=f} FlowerPath.prototype={positionAt:function(a){return{x:Math.cos(this.speed*a)/(this.coefA+this.coefB*Math.sin(this.speed*this.coefC*a)),y:Math.sin(this.speed*a)/(this.coefA+this.coefB*Math.sin(this.speed*this.coefC*a))}}};function LissajousPath(a,d,e){this.radius=a;this.sx=d;this.sy=e}LissajousPath.prototype={positionAt:function(a){return{x:this.radius*Math.cos(this.sx*a),y:this.radius*Math.sin(this.sy*a)}}}; function PulsatingPath(a,d,e,f,g,h,l,k){this.speed=f;this.speed2=l;this.angleShift=e;this.x=a;this.y=d;this.zoom=g/2;this.period=h;this.offset=k} PulsatingPath.prototype={positionAt:function(a){var d=this.speed*a+this.offset,a=this.speed2*a+this.angleShift*(Math.floor(d/(this.period+1))+((Math.floor(d)&this.period)==this.period?0.5*(1+Math.cos(d*Math.PI)):0)),d=(Math.floor(d)&this.period)==this.period?1+this.zoom*(1-Math.cos(2*d*Math.PI)):1;return{x:d*(this.x*Math.cos(a)+this.y*Math.sin(a)),y:d*(-this.x*Math.sin(a)+this.y*Math.cos(a))}}};function CollisionHandler(a){this.level=a} CollisionHandler.prototype={testBrickHits:function(){for(var a=!1,d=0;d<this.level.ballsInPlay;++d)for(var e=0;e<this.level.bricks.length;++e)if(this.level.bricks[e].alive){var f=this.level.bricks[e].posX-this.level.balls[d].posX,g=this.level.bricks[e].posY-this.level.balls[d].posY,h=this.level.balls[d].radius+this.level.bricks[e].radius;Math.sqrt(f*f+g*g)<h&&(a=!0,this.level.hitBrick(e),f=Math.atan2(g,f),this.level.balls[d].heading=2*f-Math.PI-this.level.balls[d].heading)}return a},testPadHits:function(){for(var a= !1,d=0;d<this.level.ballsInPlay;++d)if(0>this.level.balls[d].stuckOnPad)for(var e=0,f=0;f<this.level.padCount;++f)if(e+=this.level.padAngle[f],0<=Math.cos(e-this.level.balls[d].heading)){var g=Math.cos(e),h=Math.sin(e);Math.abs(g*this.level.balls[d].posX+h*this.level.balls[d].posY-this.level.padRadius)<this.level.balls[d].radius&&(g=-h*this.level.balls[d].posX+g*this.level.balls[d].posY,Math.abs(g)<this.level.padWidth&&(a=!0,20==this.level.environmentItem?(this.level.balls[d].stuckOnPad=f,this.level.balls[d].offsetOnPad= g):this.level.balls[d].heading=2*(e+Math.PI)-Math.PI-this.level.balls[d].heading))}return a},testFloaterHits:function(){for(var a=0,d=[],e=0;e<this.level.padCount;++e)for(var a=a+this.level.padAngle[e],f=Math.cos(a),g=Math.sin(a),h=0;h<this.level.floaters.length;++h)Math.abs(f*this.level.floaters[h].posX+g*this.level.floaters[h].posY-this.level.padRadius-0.5*this.level.padThickness)<this.level.floaters[h].radius+0.5*this.level.padThickness&&Math.abs(-g*this.level.floaters[h].posX+f*this.level.floaters[h].posY)< this.level.padWidth&&(d.push([this.level.floaters[h].item,e]),this.level.floaters[h].hit=!0);for(a=0;a<d.length;++a)this.level.itemActivated(d[a][0],d[a][1]);return 0<d.length}};function Controls(){this.stance=1;this.totalClear()} Controls.prototype={partialClear:function(){this.controlEscape=this.controlFire=this.controlDown=this.controlUp=!1;this.areaClicked=this.lastKeyDown=0},totalClear:function(){this.partialClear();this.mouseControlRight=this.mouseControlLeft=this.controlRight=this.controlLeft=!1},toggleStance:function(){this.stance*=-1},getAngularDirection:function(){return this.stance*((this.controlLeft||this.mouseControlLeft?-1:0)+(this.controlRight||this.mouseControlRight?1:0))},onKeyUp:function(a){return!this.keyControl(a, !1)},onKeyDown:function(a){return!this.keyControl(a,!0)},mouseControl:function(a,d,e){switch(d){case 8:this.mouseControlLeft=e;break;case 9:this.mouseControlRight=e;break;default:var d=document.getElementById("c").style.top,f=Math.min(window.innerWidth,window.innerHeight);0<f&&(a=(a.clientY-parseInt(d))/f,0.2<a&&(0.8>a&&e)&&(this.areaClicked=Math.floor((a-0.08)/0.12)),this.controlEscape|=0.2>a);this.controlFire=this.controlFire||e}return!0},keyControl:function(a,d){var e=!0,f=0,f=window.event?window.event.keyCode: a.which;d&&(this.lastKeyDown=f);switch(f){case 37:case 74:this.controlLeft=d;break;case 38:case 65:this.controlUp=d;break;case 39:case 75:this.controlRight=d;break;case 40:case 81:this.controlDown=d;break;case 32:case 13:this.controlFire=d;break;case 80:case 27:this.controlEscape=d;break;default:e=!1}return e}};function Floater(a,d,e,f){this.posX=a;this.posY=d;this.speedR=0.01;this.phiAmplitude=this.constantPhi=0;this.phiFrequency=0.2;this.radius=0.08;this.t0=e;this.item=f;this.hit=!1} Floater.prototype={move:function(a){var d=Math.sqrt(this.posX*this.posX+this.posY*this.posY),e=Math.atan2(this.posY,this.posX),d=d+this.speedR,e=e+(this.constantPhi+this.phiAmplitude*Math.cos(this.phiFrequency*(a-this.t0)));this.posX=d*Math.cos(e);this.posY=d*Math.sin(e);return d}}; function Game(a,d){this.transitionToHof=this.transitionTimer=0;this.menuOffset=10;this.controls=a;this.level=new Level(this.controls,d);this.hof=[];for(var e=0;16>e;++e)this.hof.push(["...",1E3*(16-e)]);this.menu=new MenuDriver(a,d);this.signingToHof=-1} Game.prototype={launchMenu:function(){this.menu.initialize();this.startLevel(0);this.menu.active=!0;this.eventType=0;var a=this;this.intervalId=setInterval(function(){a.mainLoop()},40)},startGame:function(){this.level.initialize();this.score=0;this.startLevel(1)},startLevel:function(a){this.level.createContents(a);a&&this.level.giveInitialBall(!0)},mainLoop:function(){this.level.level&&(this.controls.controlEscape&&3!=this.eventType)&&(this.menu.active=!0,this.menu.done=!1,this.controls.partialClear()); this.menuOffset=this.menu.active?Math.max(this.menuOffset-1,0):Math.min(this.menuOffset+1,10);this.level.animateItems(!this.menu.active);this.renderer.drawMain();this.menu.active&&(this.menu.processEvents(),this.menu.done&&(this.menu.selectedOption?(this.eventType=3,this.transitionTimer=1):this.level.level||this.startGame()));this.controls.partialClear();if(this.transitionTimer)if(--this.transitionTimer)3==this.eventType&&10>this.transitionTimer&&(this.transitionToHof=Math.min(this.transitionToHof+ 1,10));else switch(this.eventType){case 1:this.startLevel(this.level.level);break;case 2:this.level.giveInitialBall(!1);break;case 3:this.level.ballsInPlay=0;clearInterval(this.intervalId);this.recordScore(this.level.score);this.level.score=0;this.hofLoop();break;case 4:this.level.ballsInPlay=0,clearInterval(this.intervalId),this.endGameLoop()}else if(this.eventType=0,this.transitionToHof=Math.max(this.transitionToHof-1,0),this.level.level&&(this.level.lost()&&(this.level.soundManager.playBallLoss(), this.transitionTimer=this.level.lives?50:100,this.eventType=this.level.lives?2:3,--this.level.lives),this.level.won()))++this.level.level,this.transitionTimer=14==this.level.level?1:70,this.eventType=14==this.level.level?4:1},endGameLoop:function(){this.renderer.drawEndGame();if(this.controls.controlFire)this.controls.totalClear(),this.recordScore(this.level.score),this.hofLoop();else{var a=this;setTimeout(function(){a.endGameLoop()},40)}},hofLoop:function(){this.transitionToHof=Math.min(this.transitionToHof+ 1,10);this.menuOffset=Math.min(this.menuOffset+1,10);-1<this.signingToHof&&(8==this.controls.lastKeyDown||46==this.controls.lastKeyDown?this.hof[this.signingToHof][0]=this.hof[this.signingToHof][0].substr(0,Math.max(0,this.hof[this.signingToHof][0].length-1)):31<this.controls.lastKeyDown&&8>this.hof[this.signingToHof][0].length&&(this.hof[this.signingToHof][0]+=String.fromCharCode(this.controls.lastKeyDown)),13==this.controls.lastKeyDown&&("CHEATER"==this.hof[this.signingToHof][0]&&(this.level.canCheat= !0),this.signingToHof=-1),this.controls.totalClear());this.renderer.drawMain();if(this.controls.controlFire)this.launchMenu();else{var a=this;setTimeout(function(){a.hofLoop()},40)}},setRenderer:function(a){this.renderer=a},recordScore:function(a){this.signingToHof=-1;for(var d=0;d<this.hof.length&&-1==this.signingToHof;++d)a>this.hof[d][1]&&(this.signingToHof=d);if(-1<this.signingToHof){for(d=this.hof.length-1;d>this.signingToHof;--d)this.hof[d]=this.hof[d-1];this.hof[this.signingToHof]=["",a]}}}; function Level(a,d){this.bricks=[];this.bricksLeft=0;this.balls=[];this.ballsInPlay=0;this.floaters=[];this.padRadius=0.8;this.padThickness=0.08;this.lossDistanceSq=1;this.controls=a;this.soundManager=d;this.collisionHandler=new CollisionHandler(this);this.canCheat=!1;this.initialize()} Level.prototype={initialize:function(){this.padCount=2;this.padAngle=[0,3.1416];this.padSpeed=0.05;this.padWidth=0.16;this.score=this.environmentItemEnd=this.environmentItem=this.time=this.floaters.length=0;this.lives=3;this.cameraRoll=0;this.ballMinSpeed=0.02;this.lastItem=0},createContents:function(a){this.floaters.length=0;this.bricks.length=0;switch(a){case 1:this.createLevel1();break;case 2:this.createLevel2();break;case 3:this.createLevel3();break;case 4:this.createLevel4();break;case 5:this.createLevel5(); break;case 6:this.createLevel6();break;case 7:this.createLevel7();break;case 8:this.createLevel8();break;case 9:this.createLevel9();break;case 10:this.createLevel10();break;case 11:this.createLevel11();break;case 12:this.createLevel12();break;case 13:this.createLevel13();break;default:this.createLevel0()}this.bricksLeft=this.bricks.length;this.level=a},giveInitialBall:function(a){this.padCount=2;1==this.padAngle.length&&this.padAngle.push(Math.PI);if(a||!this.padAngle.length)this.padAngle=[0,3.1416]; this.padAngle.length=2;this.padSpeed=0.05;this.padWidth=0.16;this.ballsInPlay=1;this.balls[0]=new Ball(0);this.balls.length=1;this.environmentItemEnd=this.environmentItem=this.cameraRoll=0},won:function(){return!this.bricksLeft},lost:function(){return!this.ballsInPlay},animateItems:function(a){if(a&&this.padCount){this.padAngle[0]+=this.controls.getAngularDirection()*this.padSpeed;16==this.environmentItem&&(this.cameraRoll+=this.controls.getAngularDirection()*this.padSpeed,this.cameraRoll+=this.cameraRoll> Math.PI?-2*Math.PI:this.cameraRoll<-Math.PI?2*Math.PI:0);for(var d=2*Math.PI/this.padCount,e=1;e<this.padCount;++e)this.padAngle[e]=0.01>Math.abs(this.padAngle[e]-d)?d:this.padAngle[e]+(this.padAngle[e]>d?-0.01:0.01)}this.ballsInPlay||(e=0<this.cameraRoll?-0.05:0.05,Math.abs(e)>Math.abs(this.cameraRoll)&&(e=-this.cameraRoll),this.cameraRoll+=e);120==this.controls.lastKeyDown&&this.canCheat&&(this.bricksLeft=0);for(e=0;e<this.ballsInPlay&&a;++e){-1<this.balls[e].stuckOnPad&&this.controls.controlFire&& (this.balls[e].heading=this.padAngle[this.balls[e].stuckOnPad]+Math.PI+this.balls[e].offsetOnPad/200,this.balls[e].stuckOnPad=-1);if(-1<this.balls[e].stuckOnPad&&!this.controls.controlFire)d=this.padAngle[this.balls[e].stuckOnPad],this.balls[e].posX=Math.cos(d)*(this.padRadius-this.balls[e].radius)-Math.sin(d)*this.balls[e].offsetOnPad,this.balls[e].posY=Math.sin(d)*(this.padRadius-this.balls[e].radius)+Math.cos(d)*this.balls[e].offsetOnPad;else{var d=this.balls[e].speed*Math.cos(this.balls[e].heading), f=this.balls[e].speed*Math.sin(this.balls[e].heading);if(18==this.environmentItem||19==this.environmentItem){var g=this.balls[e].posX*this.balls[e].posX+this.balls[e].posY*this.balls[e].posY,d=d+this.balls[e].posX*(18==this.environmentItem?-0.001/(g+0.01):2E-4/(g+0.01)),f=f+this.balls[e].posY*(18==this.environmentItem?-0.001/(g+0.01):2E-4/(g+0.01));this.balls[e].heading=Math.atan2(f,d);this.balls[e].speed=Math.sqrt(d*d+f*f)}else this.balls[e].speed+=this.balls[e].speed<this.ballMinSpeed?2E-4:0;this.balls[e].posX+= d;this.balls[e].posY+=f}this.balls[e].posX*this.balls[e].posX+this.balls[e].posY*this.balls[e].posY>this.lossDistanceSq&&(--this.ballsInPlay,this.balls[e]=this.balls[this.ballsInPlay],--this.balls.length,--e)}for(e=0;e<this.bricks.length;++e)if(this.bricks[e].hitEcho=!1,this.bricks[e].path&&(a=this.bricks[e].path.positionAt(this.time+this.bricks[e].relativeTime),this.bricks[e].posX=a.x,this.bricks[e].posY=a.y),7==this.level&&(this.bricks[e].radius=0.08+0.02*Math.cos(0.1*this.time+this.bricks[e].relativeTime)), 12==this.level&&this.ballsInPlay)a=this.bricks[e].posX-this.balls[0].posX,d=this.bricks[e].posY-this.balls[0].posY,this.bricks[e].radius=Math.min(0.03+0.1*(a*a+d*d),0.1);for(e=0;e<this.floaters.length;++e)if(this.floaters[e].move(this.time)>this.lossDistanceSq||this.floaters[e].hit)this.deleteFloater(e),--e;this.newItem=!1;this.collisionHandler.testBrickHits()&&this.soundManager.playBrickHit();this.collisionHandler.testPadHits()&&this.soundManager.playPadHit();this.collisionHandler.testFloaterHits()&& this.soundManager.playFloaterCaught();++this.time;this.time>=this.environmentItemEnd&&(this.environmentItem=0)},hitBrick:function(a){17==this.environmentItem?this.bricks[a].hitEcho=!0:this.bricks[a].receiveHit(this.time)&&(0.8<Math.random()&&this.createFloater(a),--this.bricksLeft,this.score+=10*this.bricks[a].value*(9+this.ballsInPlay)*(12-this.padCount))},itemActivated:function(a,d){this.lastItem=a;this.newItem=!0;switch(a){case 1:this.padWidth=Math.min(this.padWidth+0.04,0.32);break;case 2:this.padWidth= Math.max(this.padWidth-0.04,0.08);break;case 3:this.padAngle.push(Math.PI/this.padCount);++this.padCount;break;case 4:++this.lives;break;case 5:for(var e=0,f=0;f<this.ballsInPlay;++f)if(-1==this.balls[f].stuckOnPad){var g=Object.create(this.balls[f]);g.heading+=Math.PI;this.balls.push(g);++e}this.ballsInPlay+=e;break;case 6:for(f=0;f<this.ballsInPlay;++f)this.balls[f].speed-=0.005;break;case 7:for(e=d+1;e<this.padCount;++e)this.padAngle[e-1]=this.padAngle[e]+(e==d+1?this.padAngle[e-1]:0);--this.padAngle.length; --this.padCount;break;case 8:this.padSpeed=Math.max(this.padSpeed-0.01,0.03)}15<a&&(this.environmentItem=a,this.environmentItemEnd=this.time+300)},createFloater:function(a){var a=this.bricks[a],d=1+Math.floor(13*Math.random());this.floaters.push(new Floater(a.posX,a.posY,this.time,d+(8<d?7:0)))},deleteFloater:function(a){this.floaters[a]=this.floaters[this.floaters.length-1];--this.floaters.length},createLevel0:function(){for(var a=[[3,2,1,1,2,3,7,3,2,0,3,2,2,3,1],[5,5,1,1,5,5,1,5,5,0,4,5,3,4,1], [3,7,1,1,7,3,7,5,7,0,2,5,2,2,5],[5,5,1,1,5,5,1,5,5,0,1,5,2,4,3],[7,5,7,7,5,5,7,5,5,0,7,2,2,3,5]],d=0;d<a.length;++d)for(var e=new CircularPath(0.95-0.09*d,0.03),f=0;f<a[d].length;++f)for(var g=0;3>g;++g)if(a[d][f]&1<<g){var h=new Brick(0,0,f&7);h.path=e;h.relativeTime=-3.2*(g+4*f);h.radius=0.04;this.bricks.push(h)}},createLevel1:function(){this.bricks.push(new Brick(0,0,2));for(var a=1;3>a;++a)for(var d=0;d<6*a;++d)this.bricks.push(new Brick(0.24*a*Math.cos(6.28*d/(6*a)),0.24*a*Math.sin(6.28*d/(6* a)),2-a))},createLevel2:function(){for(var a=1;4>a;++a)for(var d=new CircularPath(0.24*a-0.12,0.03),e=[0,3,6,6][a],f=0;f<e;++f){var g=new Brick(0,0,4+(6==e&&f&1?1:0)+(3==a?1:0));g.path=d;g.relativeTime=210*f/e+5*a;this.bricks.push(g)}},createLevel3:function(){this.bricks.push(new Brick(0,0,0));for(var a=1;4>a;++a)for(var d=new CircularPath(0.18*a,a&1?0.03:-0.03),e=0;e<6*a;++e){var f=new Brick(0,0,[0,1,4,3][a]);f.path=d;f.relativeTime=35*e/a;this.bricks.push(f)}},createLevel4:function(){for(var a= 0;3>a;++a)for(var d=new DoubleCircularPath(0.38,2E-4,0.2,0.03),e=0;6>e;++e){var f=new Brick(0,0,[1,4,6][a]);f.path=d;f.relativeTime=35*e+10500*a;this.bricks.push(f)}},createLevel5:function(){for(var a=new HarmonicPath(0.2,0.015,0.05,0.045),d=0;6>d;++d){var e=new Brick(0,0,3);e.radius=0.06;e.path=a;e.relativeTime=280*d/4;this.bricks.push(e)}a=new HarmonicPath(0.55,0.015,0.08,0.09);for(d=0;24>d;++d)e=new Brick(0,0,6),e.radius=0.06,e.path=a,e.relativeTime=70*d/4,this.bricks.push(e)},createLevel6:function(){for(var a= 0;24>a;++a){var d=new OscillatingPath(0.18*Math.floor(a/6)-0.27,0.3,0.18*(a%6)-0.5,0.015,0.045,3.1416*a),e=new Brick(0,0,[5,8][a&1]);e.path=d;e.relativeTime=0;this.bricks.push(e)}},createLevel7:function(){this.bricks.push(new Brick(0,0,8));for(var a=1;3>a;++a)for(var d=0;d<6*a;++d){var e=new Brick(0.24*a*Math.cos(6.28*d/(6*a)),0.24*a*Math.sin(6.28*d/(6*a)),[8,6,8][a]);e.relativeTime=d+2*a;e.hitPoints=2;this.bricks.push(e)}},createLevel8:function(){for(var a=0;6>a;++a){var d=new Brick(0,0,1),e=0.6* Math.cos(Math.PI*a/3),f=0.6*Math.sin(Math.PI*a/3),e=new PulsatingPath(e,f,Math.PI/6,0.03,-0.33,1,0.01,0);d.path=e;this.bricks.push(d)}for(a=0;6>a;++a)d=new Brick(0,0,4),e=0.4*Math.cos(Math.PI*(a+0.25)/3),f=0.4*Math.sin(Math.PI*(a+0.25)/3),e=new PulsatingPath(e,f,Math.PI/6,0.03,-0.33,1,0.01,Math.PI),d.path=e,this.bricks.push(d)},createLevel9:function(){for(var a=new LissajousPath(0.4,0.03,0.02),d=0;20>d;++d){var e=new Brick(0,0,7);e.path=a;e.relativeTime=6.28*d/0.2;this.bricks.push(e)}},createLevel10:function(){for(var a= 0;16>a;++a){var d=new Brick(0,0,[0,2,3,4][a>>2]),e=new PulsatingPath([0,1,0,-1,-1,-2,-3,-2,0,-1,0,1,1,2,3,2][a]/8,[1,2,3,2,0,1,0,-1,-1,-2,-3,-2,0,-1,0,1][a]/8,Math.PI/2,0.03,1,7,0,0);d.path=e;this.bricks.push(d)}},createLevel11:function(){for(var a=0;6>a;++a)for(var d=0;3>d;++d){var e=new Brick(0,0,[2,8,4,8,7,8][a]),f=[0.6,0.3,0.6][d]*Math.cos(2*Math.PI*(a/6+(d-1)/28)),g=[0.6,0.3,0.6][d]*Math.sin(2*Math.PI*(a/6+(d-1)/28)),f=new PulsatingPath(f,g,-Math.PI/6,0.03,-0.4,3,0,0);e.path=f;this.bricks.push(e)}}, createLevel12:function(){this.bricks.push(new Brick(0,0,8));for(var a=1;3>a;++a)for(var d=0;d<6*a;++d)this.bricks.push(new Brick(0.24*a*Math.cos(6.28*d/(6*a)),0.24*a*Math.sin(6.28*d/(6*a)),[8,1,8][a]))},createLevel13:function(){for(var a=[[5,2,9,0],[2,2,9,0],[5,2,9,0]],d=0;3>d;++d){for(var e=new CircularPath(0.6-0.09*d,0.03),f=0;16>f;++f)for(var g=0;4>g;++g)if(a[d][f&3]&1<<g){var h=new Brick(0,0,[1,6,2,7][f>>2]);h.path=e;h.relativeTime=-3.2*(g+4*f);h.radius=0.04;this.bricks.push(h)}for(f=0;3>f;++f)for(g= 0;4>g;++g)a[d][f&3]&1<<g&&(h=new Brick(0.05*(g+4*f-5.6),0.1*(d-1),0),h.radius=0.04,h.hitPoints=7,this.bricks.push(h))}}};function MenuDriver(a,d){this.controls=a;this.soundManager=d;this.optionCount=5;this.active=!1} MenuDriver.prototype={initialize:function(){this.done=!1;this.selectedOption=0;this.controls.totalClear()},getSelectedOption:function(){return this.selectedOption},processEvents:function(){this.selectedOption+=(this.controls.controlUp&&0<this.selectedOption?-1:0)+(this.controls.controlDown&&this.selectedOption<this.optionCount-1?1:0);this.controls.areaClicked&&(this.selectedOption=this.controls.areaClicked-1);if(this.controls.controlFire)switch(this.selectedOption){case 1:this.controls.toggleStance(); break;case 2:this.soundManager.toggleMusic();break;case 3:this.soundManager.toggleSound();break;default:this.done=!0,this.active=!1}this.controls.totalClear()}}; var CPlayer=function(){var a=function(a){return Math.sin(6.283184*a)},d=[a,function(a){return 0.5>a%1?1:-1},function(a){return 2*(a%1)-1},function(a){a=4*(a%1);return 2>a?a-1:3-a}];this.init=function(a,d,g){this.firstRow=0;this.lastRow=a.endPattern-2;this.firstCol=0;this.lastCol=a.songData.length-1;this.globalVolume=d||1;g&&(this.firstRow=g.firstRow,this.lastRow=g.lastRow,this.firstCol=g.firstCol,this.lastCol=g.lastCol);this.song=a;this.numSamples=32*a.rowLen*(this.lastRow-this.firstRow+1);this.numWords= 2*this.numSamples;this.chnBufWork=new Int32Array(this.numWords);this.mixBufWork=new Int32Array(this.numWords);this.currentCol=this.firstCol;this.currentRow=this.firstRow};this.generate=function(){var e,f,g,h,l,k,m,j,q,n,o=this.chnBufWork,u=this.mixBufWork;g=this.numWords;var i=this.song.songData[this.currentCol],r=this.song.rowLen;if(this.currentRow==this.firstRow)for(f=0;f<g;f++)o[f]=0;var v=0,s=0,p;n=!1;var w=this.currentRow+8,w=w>this.lastRow?this.lastRow:w;for(f=this.currentRow;f<=w;++f){l=i.p[f]; for(g=0;32>g;++g){(q=l?i.c[l-1].fx[g]:0)&&(i.i[q-1]=i.c[l-1].fx[g+32]||0);p=d[i.i[0]];var G=i.i[1],H=i.i[3],I=d[i.i[4]],J=i.i[5],K=i.i[8],C=i.i[9],t=4*i.i[10]*i.i[10],x=4*i.i[11]*i.i[11],D=4*i.i[12]*i.i[12],L=d[i.i[13]],M=i.i[14]/512,N=Math.pow(2,i.i[15]-9)/r,O=i.i[16],E=i.i[17],P=135.82764118168*i.i[18]/44100,Q=1-i.i[19]/255,y=1E-5*i.i[20],R=i.i[21]/32,S=i.i[22]/512,T=6.283184*Math.pow(2,i.i[23]-9)/r,F=i.i[24]/255,z=i.i[25]*r;q=(32*(f-this.firstRow)+g)*r;for(h=0;4>h;++h)if(e=l?i.c[l-1].n[g+32*h]: 0){var U=0.003959503758*Math.pow(2,(e+i.i[2]-128-128)/12),V=0.003959503758*Math.pow(2,(e+i.i[6]-128-128)/12)*(1+8E-4*i.i[7]),A=0,B=0;for(e=0;e<t+x+D;e++)m=1,e<t?m=e/t:e>=t+x&&(m-=(e-t-x)/D),k=U,H&&(k*=m*m),A+=k,j=p(A)*G,k=V,K&&(k*=m*m),B+=k,j+=I(B)*J,C&&(j+=(2*Math.random()-1)*C),o[2*(q+e)]+=80*j*m|0}for(e=0;e<r;e++)h=2*(q+e),(j=o[h])||n?(n=P,O&&(n*=L(N*h)*M+0.5),n=1.5*Math.sin(n),v+=n*s,j=Q*(j-s)-v,s+=n*j,j=3==E?s:1==E?j:v,y&&(j*=y,j=1>j?-1<j?a(0.25*j):-1:1,j/=y),j*=R,n=1E-5<j*j,k=Math.sin(T*h)* S+0.5,p=j*(1-k),j*=k):p=0,h>=z&&(p+=o[h-z+1]*F,j+=o[h-z]*F),o[h]=p|0,o[h+1]=j|0,u[h]+=p*this.globalVolume|0,u[h+1]+=j*this.globalVolume|0}this.currentRow++}this.currentRow>this.lastRow&&(this.currentRow=this.firstRow,this.currentCol++);return{done:this.currentCol>this.lastCol,progress:(this.currentCol-this.firstCol+(this.currentRow-this.firstRow)/(this.lastRow-this.firstRow+1))/(this.lastCol-this.firstCol+1)}};this.createWave=function(){var a,d,g,h,l,k=this.mixBufWork,m=this.numWords;this.chnBufWork= null;a=2*m-8;d=a-36;h=String.fromCharCode(82,73,70,70,a&255,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,d&255,d>>8&255,d>>16&255,d>>24&255);for(a=0;a<m;){g="";for(d=0;256>d&&a<m;++d,a++)l=k[a],l=-32767>l?-32767:32767<l?32767:l,g+=String.fromCharCode(l&255,l>>8&255);h+=g}return h};this.getData=function(a,d){for(var g=2*Math.floor(44100*a),h=Array(d),l=this.mixBufWork,k=0;k<2*d;k+=1){var m=g+k;h[k]=0<a&&m<l.length?l[m]/32768: 0}return h}};function SoundManager(){this.musicOn=this.soundOn=!0} SoundManager.prototype={initialize:function(a,d){try{this.audioFloater=new Audio();var e=this.audioFloater.canPlayType("audio/wav");this.soundSupport="probably"==e||"maybe"==e}catch(f){this.soundSupport=!1}if(this.soundSupport){this.context=a;this.game=d;a.fillStyle="white";a.fillText("decrunching",120,10);var g=this;setTimeout(function(){g.init2()},1)}else this.musicOn=this.soundOn=!1,d.launchMenu()},init2:function(){var a=new CPlayer;a.init({songData:[{i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0, 0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[123],fx:[]}]}],rowLen:5513,endPattern:2});a.generate();this.audioFloater=new Audio("data:audio/wav;base64,"+btoa(a.createWave()));a=new CPlayer;a.init({songData:[{i:[2,100,135,0,3,201,128,0,0,0,0,0,40,0,195,4,1,3,50,184,119,160,147,6,84,6],p:[1],c:[{n:[123,,134,,132,,130,,128,,127,,,,,,,,,,,,,,,,,,,,,,123,,122,,120,,118,,116,,115],fx:[]}]}],rowLen:5513,endPattern:2});a.generate();this.audioBallLoss=new Audio("data:audio/wav;base64,"+btoa(a.createWave())); a=new CPlayer;a.init({songData:[{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,14,39,76,5,0,0],p:[1],c:[{n:[147],fx:[]}]}],rowLen:5513,endPattern:2});a.generate();this.audioPadHit=new Audio("data:audio/wav;base64,"+btoa(a.createWave()));a=new CPlayer;a.init({songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,96,3,1,3,137,79,0,32,84,2,12,4],p:[1],c:[{n:[135],fx:[]}]}],rowLen:5513,endPattern:2});a.generate();this.audioBrickHit=new Audio("data:audio/wav;base64,"+btoa(a.createWave()));this.songGen5= new CPlayer;this.songGen5.init({songData:[{i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,33,47,3,146,2],p:[5,1,2,3,4,,,,,6,7,6,7,8,9,10,,1,2,3,4],c:[{n:[161,,,,,,163,,164,,163,,161,,,,159,,,,156,,,,154,,,,159],fx:[]},{n:[161,,163,,161,,159,,161,,,,159,,,,161,,,,,,,,,,,,161,,163],fx:[]},{n:[164,,,,168,,,,166,,164,,163,,,,164,,163,,161,,,,163,,161,,159],fx:[]},{n:[161,,,,166,,,,163,,,,159,,,,161],fx:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,156],fx:[,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,33]},{n:[161, ,156,,156,,163,,156,,156,,161,,163,,164,,156,,156,,168,,156,,156,,164,,163],fx:[]},{n:[164,,159,,159,,168,,159,,159,,169,,166,,168,,159,,159,,164,,159,,159,,164,,163],fx:[]},{n:[169,,161,,161,,166,,161,,161,,168,,169,,166,,157,,157,,166,,157,,161,,166,,169],fx:[]},{n:[168,,159,,159,,164,,159,,159,,168,,166,,164,,156,,156,,159,,156,,159,,164,,168],fx:[]},{n:[166,,154,,154,,159,,154,,154,,163,,164,,163,,151,,151,,159,,151,,151,,161,,163],fx:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135, 0,0,32,147,6,121,6],p:[,1,2,3,4,1,2,3,4,5,6,5,6,7,8,9,10],c:[{n:[149,,,,,,149,,147,,,,147,,,,152,,,,,,,,147],fx:[]},{n:[145,,,,140,,145,,147,,,,142,,147,,149,,,,,,144,,137,,,,149,,147],fx:[]},{n:[152,,,,,,152,,147,,,,,,147,,149,,,,149,,149,,144,,,,156,,145],fx:[]},{n:[145,,,,140,,145,,147,,,,,,159,,149,,,,144,,149],fx:[]},{n:[149,,,,161,,149,,,,156,,152,,151,,149,,,,161,,149,,,,147,,149,,151],fx:[]},{n:[152,,,,168,,152,,,,147,,152,,151,,152,,,,164,,152,,,,147,,156,,152],fx:[]},{n:[154,,,,169,,154, ,,,166,,161,,157,,154,,,,166,,154,,,,149,,154,,149],fx:[]},{n:[152,,,,168,,152,,,,147,,149,,147,,152,,,,164,,152,,,,164,,168,,164],fx:[]},{n:[147,,,,159,,147,,,,147,,154,,151,,147,,,,159,,147,,,,159,,157,,159],fx:[]},{n:[144,,,,156,,151,,,,151,,154,,156,,144,,,,156,,160,,,,156,,158,,160],fx:[]}]},{i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,32,47,3,146,2],p:[,,,,,,,,,,,,,,,,1],c:[{n:[160,,156,,156,,161,,156,,156,,160,,161,,163,,156,,156,,168,,156,,166,,164,,163],fx:[]}]},{i:[2,100,128, 0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,,,,,,,,,,,,,,,,2,1,3,4],c:[{n:[169,,,,,,,,166,,,,169,,,,168,,,,,,164,,161,,,,159],fx:[]},{n:[164,,,,166,,168,,166,,,,164,,,,164,,,,159,,,,163,,,,166],fx:[]},{n:[168,,,,159,,,,163,,,,,,166,,168,,,,164,,,,156,,,,163,,159],fx:[]},{n:[157,,,,,,,,159,,,,,,,,164,,,,163,,,,161,,,,156],fx:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0],p:[,1,2,1,2,1,2,1,2,3,4,3,4,3,4,3,4,1,2,1,2],c:[{n:[148,,,,,,,,,,,,,,,,148,,,, ,,,,,,,,148],fx:[]},{n:[148,,,,,,,,,,,,,,148,,148,,,,,,,,,,,,148],fx:[]},{n:[149,,,,,,149,,,,149,,,,149,,149,,,,,,149,,,149,149,,,,149],fx:[]},{n:[149,,,,,,149,,,,149,,,,149,,149,,,,,,149,,,149,,149,,,149],fx:[]}]},{i:[3,0,128,0,3,68,128,0,1,218,4,4,40,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,,,,,,,,,1,1,1,1],c:[{n:[,,161,,153,,161,,,,,,,,,,,,161,,153,,161],fx:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0],p:[,1,2,1,3,1,2,1,4,5,6,5,6,5,6,5,6,1,2,1,3],c:[{n:[, ,,,,,,,160,,,,,,,,,,,,,,,,160],fx:[]},{n:[,,,,,,,,160,,,,,,,,,,,,,,,,160,,160,,,,160],fx:[]},{n:[,,,,,,,,160,,,,,,,,,,,,,,,,160,,160,,160,,160],fx:[]},{n:[,,,,,,,,160,,,,,,,,,,,,,,,,160,157,157,157,157,157,157,157],fx:[]},{n:[,,,,157,,,,,,,,157,,,,,,,,157,,,,,,,,157,,,157],fx:[]},{n:[,,,,157,,,,,,,,157,,,,,,,,157,,,,,,157,,157,157,,157],fx:[]}]},{i:[1,192,128,0,1,192,116,9,0,0,6,22,34,0,69,3,1,1,23,167,0,0,77,6,25,6],p:[,,,,,1,2,3,4],c:[{n:[161,,156,161,,156,163,,164,163,163,164,161,163,164,161,159, 164,161,159,156,161,159,156,154,159,156,154,159,156,154,159],fx:[,,22,22,,22,22,,,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,,,8,16,,,35,,,16,35,16,35,16,8,16,35,,8,16,35,,8,16,35,,8,16,35,,8,16]},{n:[161,154,163,161,161,163,159,161,161,159,161,161,159,161,161,159,161,161,159,161,161,159,161,161,159,161,,159,161,,163,161],fx:[22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,,22,22,,,,,22,,,22,35,,35,16,35,16,35,16,35,16,8,16,35,,8,16,35,,8,16,,,8,,,,,,35,,, 16]},{n:[164,,,164,168,,164,168,166,164,164,166,163,164,166,163,164,166,163,164,161,163,164,161,163,164,161,163,159,161,163,159],fx:[22,,,22,22,,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,35,,,16,36,,8,16,35,,35,16,35,16,8,16,35,,35,16,35,16,8,16,35,,35,16,35,16,8,16]},{n:[161,163,159,161,166,161,159,166,163,149,166,163,159,166,163,159,161,163,159,161,163,159,161,163,159,161,163,159,161,,,161],fx:[22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,,22, 22,,,,,,,,,36,,8,16,35,,8,16,35,,8,16,35,,8,17,35,,8,15,,,8]}]}],rowLen:4134,endPattern:22},0.2);this.init3()},init3:function(){var a=this.songGen5.generate();this.context.strokeStyle="#05A";this.context.strokeRect(0,20,300,10);this.context.fillStyle="#05A";this.context.fillRect(0,20,300*a.progress,10);if(a.done)this.audioMusic=new Audio("data:audio/wav;base64,"+btoa(this.songGen5.createWave())),this.audioMusic.loop=!0,this.audioMusic.play(),this.game.launchMenu();else{var d=this;setTimeout(function(){d.init3()}, 1)}},toggleSound:function(){this.soundSupport&&(this.soundOn=!this.soundOn,this.soundOn||(this.audioFloater.pause(),this.audioBallLoss.pause(),this.audioPadHit.pause(),this.audioBrickHit.pause(),this.audioMusic.pause()))},toggleMusic:function(){this.soundSupport&&((this.musicOn=!this.musicOn)?this.audioMusic.play():this.audioMusic.pause())},playBrickHit:function(){this.soundOn&&(this.audioBrickHit.currentTime=0,this.audioBrickHit.play())},playPadHit:function(){this.soundOn&&(this.audioPadHit.currentTime= 0,this.audioPadHit.play())},playBallLoss:function(){this.soundOn&&(this.audioBallLoss.currentTime=0,this.audioBallLoss.play())},playFloaterCaught:function(){this.soundOn&&(this.audioFloater.currentTime=0,this.audioFloater.play())}};var b=document.body,c=document.getElementsByTagName("canvas")[0];document.body.clientWidth; window.onload=function(){var a=new Controls;document.onkeydown=function(d){return a.onKeyDown(d)};document.onkeyup=function(d){return a.onKeyUp(d)};document.getElementById("e").onmousedown=function(d){return a.mouseControl(d,8,!0)};document.getElementById("e").onmouseup=function(d){return a.mouseControl(d,8,!1)};document.getElementById("g").onmousedown=function(d){return a.mouseControl(d,9,!0)};document.getElementById("g").onmouseup=function(d){return a.mouseControl(d,9,!1)};document.getElementById("c").onmousedown= function(d){return a.mouseControl(d,0,!0)};var d=new SoundManager,e=new Game(a,d),f=new AdvancedRenderer(c,b,e);f.initialize();e.setRenderer(f);d.initialize(c.getContext("2d"),e)};
		</script>
	

</body></html>