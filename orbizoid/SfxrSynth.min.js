function SfxrSynth(){this._params=new SfxrParams();var Y;var p;var i;var u;var ad;var j;var h;var W;var U;var S;var y;var w;var v;this._envelopeFullLength;var F;var n;var G;var O;var Z;var c;var b;var T;var E;var f;var J;var N;var o;var t;var B;var q;var C;var l;var V;var ab;var aa;var A;var Q;var I;var H;var R;var m;var D;var X;var ac;var M;var g;var L;var x;var a;var s;var k;var r;var z;var K;var e;this.reset=function P(ae){var ah=this._params;O=100/(ah.startFrequency*ah.startFrequency+0.001);c=100/(ah.minFrequency*ah.minFrequency+0.001);b=1-ah.slide*ah.slide*ah.slide*0.01;T=-ah.deltaSlide*ah.deltaSlide*ah.deltaSlide*0.000001;if(ah.waveType==0){q=0.5-ah.squareDuty*0.5;C=-ah.dutySweep*0.00005}if(ah.changeAmount>0){o=1-ah.changeAmount*ah.changeAmount*0.9}else{o=1+ah.changeAmount*ah.changeAmount*10}t=0;if(ah.changeSpeed==1){B=0}else{B=(1-ah.changeSpeed)*(1-ah.changeSpeed)*20000+32}if(ae){ah.paramsDirty=false;p=ah.masterVolume*ah.masterVolume;i=ah.waveType;if(ah.sustainTime<0.01){ah.sustainTime=0.01}var ag=ah.attackTime+ah.sustainTime+ah.decayTime;if(ag<0.18){var ai=0.18/ag;ah.attackTime*=ai;ah.sustainTime*=ai;ah.decayTime*=ai}F=ah.sustainPunch;n=0;E=ah.minFrequency;R=ah.lpFilterCutoff!=1||ah.hpFilterCutoff!=0;m=0;X=0;ac=ah.lpFilterCutoff*ah.lpFilterCutoff*ah.lpFilterCutoff*0.1;M=1+ah.lpFilterCutoffSweep*0.0001;g=5/(1+ah.lpFilterResonance*ah.lpFilterResonance*20)*(0.01+ac);if(g>0.8){g=0.8}g=1-g;L=ah.lpFilterCutoff!=1;x=0;a=ah.hpFilterCutoff*ah.hpFilterCutoff*0.1;s=1+ah.hpFilterCutoffSweep*0.0003;f=0;J=ah.vibratoSpeed*ah.vibratoSpeed*0.01;N=ah.vibratoDepth*0.5;u=0;ad=0;j=0;W=ah.attackTime*ah.attackTime*100000;U=ah.sustainTime*ah.sustainTime*100000;S=ah.decayTime*ah.decayTime*100000+10;h=W;this._envelopeFullLength=W+U+S;y=1/W;w=1/U;v=1/S;ab=ah.phaserOffset!=0||ah.phaserSweep!=0;aa=ah.phaserOffset*ah.phaserOffset*1020;if(ah.phaserOffset<0){aa=-aa}A=ah.phaserSweep*ah.phaserSweep*ah.phaserSweep*0.2;I=0;if(!H){H=new Array(1024)}if(!k){k=new Array(32)}for(var af=0;af<1024;af++){H[af]=0}for(af=0;af<32;af++){k[af]=Math.random()*2-1}l=0;if(ah.repeatSpeed==0){V=0}else{V=parseInt((1-ah.repeatSpeed)*(1-ah.repeatSpeed)*20000)+32}}};this.synthWave=function d(ae,ai,ak,ag,aj){ak=ak||false;ag=ag||44100;aj=aj||16;Y=false;K=0;e=0;for(var ah=0;ah<ai;ah++){if(Y){return ah}if(V!=0){if(++l>=V){l=0;this.reset(false)}}if(B!=0){if(++t>=B){B=0;O*=o}}b+=T;O*=b;if(O>c){O=c;if(E>0){Y=true}}Z=O;if(N>0){f+=J;Z=O*(1+Math.sin(f)*N)}Z=parseInt(Z);if(Z<8){Z=8}if(i==0){q+=C;if(q<0){q=0}else{if(q>0.5){q=0.5}}}if(++j>h){j=0;switch(++ad){case 1:h=U;break;case 2:h=S;break}}switch(ad){case 0:u=j*y;break;case 1:u=1+(1-j*w)*2*F;break;case 2:u=1-j*v;break;case 3:u=0;Y=true;break}if(ab){aa+=A;Q=parseInt(aa);if(Q<0){Q=-Q}else{if(Q>1023){Q=1023}}}if(R&&s!=0){a*=s;if(a<0.00001){a=0.00001}else{if(a>0.1){a=0.1}}}r=0;for(var af=0;af<8;af++){n++;if(n>=Z){n=n-Z;if(i==3){for(var al=0;al<32;al++){k[al]=Math.random()*2-1}}}switch(i){case 0:z=((n/Z)<q)?0.5:-0.5;break;case 1:z=1-(n/Z)*2;break;case 2:G=n/Z;G=G>0.5?(G-1)*6.28318531:G*6.28318531;z=G<0?1.27323954*G+0.405284735*G*G:1.27323954*G-0.405284735*G*G;z=z<0?0.225*(z*-z-z)+z:0.225*(z*z-z)+z;break;case 3:z=k[Math.abs(parseInt(n*32/parseInt(Z)))];break}if(R){D=m;ac*=M;if(ac<0){ac=0}else{if(ac>0.1){ac=0.1}}if(L){X+=(z-m)*ac;X*=g}else{m=z;X=0}m+=X;x+=m-D;x*=1-a;z=x}if(ab){H[I&1023]=z;z+=H[(I-Q+1024)&1023];I=(I+1)&1023}r+=z}r=p*u*r*0.125;if(r>1){r=1}else{if(r<-1){r=-1}}e+=r;K++;if(ag==44100||K==2){e/=K;K=0;ae[ah]=parseInt(32000*e);e=0}}return ai}}SfxrSynth.prototype.getWave=function(g){var h=new Uint8Array([82,73,70,70,0,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,2,0,16,0,100,97,116,97,0,0,0,0]);this._params.setSettingsString(g);this.reset(true);this._envelopeFullLength=parseInt(this._envelopeFullLength);var d=new Uint16Array(this._envelopeFullLength);var f=this.synthWave(d,this._envelopeFullLength,false);var a=f*2;var e=new Uint32Array(h.buffer);e[1]=36+a;e[10]=a;var b=new Blob([h.buffer,d.subarray(0,f-1).buffer],{type:"audio/wav"});var c=window.URL||window.webkitURL;return c.createObjectURL(b)};window.SfxrSynth=SfxrSynth;SfxrSynth.prototype.getWave=SfxrSynth.prototype.getWave;