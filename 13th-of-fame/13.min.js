(function(){function h(){g={pal:["","000","FFF","9f9f9f","31302f","f00","42362a","9d986e","645c51","271d13","E4B34D","A8751A","D4A03B","A1F8F6","0078F8","CBCBCB"],tiles:[[[3,1,0,0],"17002103f0107f010bf010ff0171011f002134021b40213c021bc02178021f802"],[[6,7,8,0],a="100f02010e153a0254012351023609"],[[6,7,8,0],a,true],[[6,7,8,9],b="2000f2300933a1025a0135ca031fe0"],[[6,7,8,9],b,true],[[6,7,8,0],"100f0103f0"],[[6,7,8,9],"30ff030cf0"],[[7,6,4,0],"1000f1300f1600f1900f1c00f1f00f2111121d112d711"],[[10,14,13,0],"130cb2101123211214132381123a3126a1128c112aa312dc21"],[[10,14,13,0],"100fb20c1122a312681128a1106a112ac312ea11"],[[10,14,13,0],"130cf21e1123a132581123611038112121323011"],[[10,2,11,16],"2422023310273302241029430215102b510216042c711"],[[10,14,13,0],"100ff"],[[10,11,12,0],"13100142001b40023600276002d600259001990013a0027b001cc0015d002cd10"],[[0,1,0,0],"100ff"],[[7,6,4,0],"1000f1300f1600f1900f1c00f1f00f"],[[0,2,3,4],"2685514077362513841130568268711e8112e01736a113aa1135e113ae11"],[[0,5,3,4],"25045241032a1033534037401356402476425c4135e1138e113370634c013ac013b8053c90416820179001590216a201990217b0016c20"],[[14,7,6,2],"110e1122d0143b01649018573198631ac501bd411cf30210e0243602b4402c5002d601298302e8002d9202ce202ff00"],[[14,7,6,2],"100ff20050270812d2002e3002f40020420235b02092023a3027b802cc002dd002ee0120f20"],[[14,7,6,2],"100ff200a22b14120500216e020bf0"],[[14,7,6,2],"100ff210e0201f0202b02e2002f301235c0206202270023800249002f90020af02fe0029f50"],[[14,7,6,2],"100f5106e1108d0109c110bb010ca010d9010e7010f60200f0201902f300224d0205102e60129840209802c90120b002bb0021c102ac0023d6020e3027e0026f00"],[[14,7,6,2],"200e0101c02d1001024025200203302041020500"],[[14,7,6,2],"21be011ce011d0222d0216d0227d021cd022dd02"],[[14,7,6,2],"20b7010c6011d0222d0216d0227c033b0443c5331c8201f900"],[[14,7,6,2],"3007938207396033a8023ba001094015a401ab101c02f1bd022f0061f709"],[[14,7,6,2],"340b0351a2344b1336c033780328703296031a0033a3031b102070410c0311c1021d0213b4018a401d920"],[[14,7,6,2],"3004635105363033750134730187102a7001384010920"],[[14,7,6,2],"3fa053eb043dd023cf00"],[[14,7,6,2],"1c1072d10715730196601c9162e9063972035850309a030a9130c8130e713e7103f800"],[[14,7,6,2],"11540106003166030790308b0309d032ad033bc234eb1"],[[14,7,6,2],"30b0431c1333d0234f00"],[[0,13,2,1],c="239c6157a0138c01293012a1011b2011c133fb0438b14"],[[0,13,2,1],c,true],[[0,13,2,1],d="230c611013114201251012630137c0158a03f0013f3013801138311"],[[0,13,2,1],d,true]],scene:[[["266666666666666666666663"+"477777777777777777777775"+"1000ee00000000e0bdddddd1"+"10e00e000e000e00bduvwxd1"+"1000c000000e0c0ebpqrstd1"+"1000e0000e000000bjkgmno1"+"10e00000000000009aagaaa1"+"100000c0cccc0e0000000e01"+"10000cc0000c000e0e000001"+"1c0000c0cccc000c000e0001"+"10e000c0000c0000e00c00e1"+"100000c0cccc0000000e0001"+"100e0000e000e000e0000001"+"100000e0000000c000118111"+"10e0000000e00e00001ffff1"+"1000e000000c000e001ffff1"+"111111111111111111111111"]]],strings:{splash:"The myth tells us that on Friday, 13 October 1307, the Knights Templar were arrested, charged with heresy, immorality and abuses. The fear of Friday the 13th was born.<br/><br/>Save 13 knights from jail, and help them to board the ship to a new world.<span id='btn-play' class='lnk-txt' style='margin-top:"+4*16*f.pixelSize+"px;' title='Press me to play!'>load\"*\",8,1</span>",over:"You loose!<br/><br/>Oh, forever unlucky Friday the 13th!<span id='btn-play' class='lnk-txt' style='margin-top:"+8*16*f.pixelSize+"px;'>Play again</span>",win:"You win!<br/><br/>You saved the World from Friday the 13th curse!<span id='btn-play' class='lnk-txt' style='margin-top:"+5*16*f.pixelSize+"px;'>Play again</span>"},spriteHTML:[],curScene:-1,coins:0,mapHTML:"",keys:[],interval:g&&g.interval||0,size:16*f.pixelSize,knights:[],enemies:[],numEnemies:g&&g.numEnemies||5,kJailed:0,kShipped:0,activeScene:"SPLASH"};for(var e=0;e<g.tiles.length;e++){var h=0;var i=g.tiles[e][1]+"";while(h<i.split("").length){g.spriteHTML[e]=(g.spriteHTML[e]||"<div style='width:"+g.size+"px; height:"+g.size+"px;"+(g.pal[g.tiles[e][0][0]]!==""?"background-color:#"+g.pal[g.tiles[e][0][0]]:"")+"' >")+(g.tiles[e][0][parseInt(i[h],16)]!==""?"<div style='"+"left:"+(g.tiles[e][2]?16-parseInt(i[h+1],16)-(parseInt(i[h+3],16)+1):parseInt(i[h+1],16))*f.pixelSize+"px;"+"top:"+parseInt(i[h+2],16)*f.pixelSize+"px;"+"width:"+(parseInt(i[h+3],16)+1)*f.pixelSize+"px;"+"height:"+(parseInt(i[h+4],16)+1)*f.pixelSize+"px;"+"background-color:#"+g.pal[g.tiles[e][0][parseInt(i[h],16)]]+";"+"overflow:hidden;"+"'></div>":"")+((h+=5)>=i.length?"</div>":"")}}return g}function i(a,b){var c;for(var d=0;d<g.map.length;d++){c=g.map[d].split("");if(c[Math.floor(b/g.size)*24+Math.floor(a/g.size)]!=="0"&&parseInt(c[Math.floor(b/g.size)*24+Math.floor(a/g.size)],16)<13){return true}}return false}function j(a,b){var c,d,e,g;c=d=e=g=16*(f.pixelSize/2);return a.newPos.y>=b.newPos.y&&a.newPos.y<=b.newPos.y+g&&(a.newPos.x<=b.newPos.x&&a.newPos.x+c>=b.newPos.x||a.newPos.x>=b.newPos.x&&a.newPos.x<=b.newPos.x+e)||a.newPos.y<=b.newPos.y&&a.newPos.y+d>=b.newPos.y&&(a.newPos.x<=b.newPos.x&&a.newPos.x+c>=b.newPos.x||a.newPos.x>=b.newPos.x&&a.newPos.x<=b.newPos.x+e)}function k(a,b){b=b?b:document;return b.querySelector(a)}function l(a){this.id=a.id;this.enemy=a.enemy||false;this.start=a.start;this.mov=a.enemy?{x:1,y:1}:{x:0,y:0};this.oldPos={x:0,y:0};this.newPos={x:0,y:0};this.dirX=1;this.html=a.html;this.state=a.state||"A";this.element=null;this.draw=function(){g.dom.game.innerHTML+="<div id='"+(a.enemy?"enemy_":"")+"mSprite_"+a.id+"' class='"+(a.enemy?"enemy":"knight")+"' style='"+"left:"+this.start.x*g.size+"px;"+"top:"+this.start.y*g.size+"px;"+"width:"+g.size+"px;"+"height:"+g.size+"px;'>"+this.html+"</div>";return this};this.getSprite=function(){return k("#"+(a.enemy?"enemy_":"")+"mSprite_"+this.id)};this.setNewPos=function(){this.newPos={x:Math.min(24*g.size-g.size,Math.max(0,(this.oldPos.x=parseInt(this.getSprite().style.left||0,10))+(this.mov.x=this.enemy?g.activeKnight.newPos.x<=this.oldPos.x?Math.max(-1.5+Math.random(),--this.mov.x+Math.random()):g.activeKnight.newPos.x>=this.oldPos.x?Math.min(1.5+Math.random(),++this.mov.x+Math.random()):Math.abs(this.mov.x)>.7*f.pixelSize?this.mov.x<0?this.mov.x+.7*f.pixelSize:this.mov.x-.7*f.pixelSize:0:this.state==="J"||this.state==="S"?this.oldPos.x>=21*g.size-g.size?--this.mov.x+Math.random():++this.mov.x+Math.random():g.keys[37]?Math.max(-4,--this.mov.x):g.keys[39]?Math.min(4,++this.mov.x):Math.abs(this.mov.x)>.7*f.pixelSize?this.mov.x<0?this.mov.x+.7*f.pixelSize:this.mov.x-.7*f.pixelSize:0))),y:Math.min(24*g.size-g.size,Math.max(0,(this.oldPos.y=parseInt(this.getSprite().style.top||0,10))+(this.mov.y=this.enemy?g.activeKnight.newPos.y<=this.oldPos.y?Math.max(-1.5+Math.random(),--this.mov.y+Math.random()):g.activeKnight.newPos.y>=this.oldPos.y?Math.min(1.5+Math.random(),++this.mov.y+Math.random()):Math.abs(this.mov.y)>.7*f.pixelSize?this.mov.y<0?this.mov.y+.7*f.pixelSize:this.mov.y-.7*f.pixelSize:0:this.state==="J"||this.state==="S"?0:g.keys[38]?Math.max(-4,--this.mov.y):g.keys[40]?Math.min(4,++this.mov.y):Math.abs(this.mov.y)>.7*f.pixelSize?this.mov.y<0?this.mov.y+.7*f.pixelSize:this.mov.y-.7*f.pixelSize:0)))}};this.setLeft=function(){this.getSprite().style.left=(this.newPos.x=Math.round(this.mov.x?this.mov.x<0?i(this.newPos.x,this.oldPos.y)||i(this.newPos.x,this.oldPos.y+15*f.pixelSize)?Math.floor(this.oldPos.x/g.size)*g.size:this.newPos.x:i(this.newPos.x+g.size,this.oldPos.y)||i(this.newPos.x+g.size,this.oldPos.y+15*f.pixelSize)?Math.ceil(this.oldPos.x/g.size)*g.size:this.newPos.x:this.oldPos.x))+"px"};this.setTop=function(){this.getSprite().style.top=(this.newPos.y=Math.round(this.mov.y?this.mov.y<0?i(this.oldPos.x,this.newPos.y)||i(this.oldPos.x,this.newPos.y+15*f.pixelSize)?Math.floor(this.oldPos.y/g.size)*g.size:this.newPos.y:i(this.oldPos.x,this.newPos.y+g.size)||i(this.oldPos.x+g.size,this.newPos.y+15*g.pixelSie)?Math.ceil(this.oldPos.y/g.size)*g.size:this.newPos.y:this.oldPos.y))+"px"};this.move=function(){if(this.state!=="C"){this.setNewPos();this.setLeft();this.setTop()}};this.toJail=function(){g.kJailed++;this.state="J"};this.toShip=function(){g.kShipped++;this.state="S"};this.imprecate=function(){g.dom.game.innerHTML+="<div id='cloud' style='position: absolute;left:"+(this.newPos.x+g.size/2)+"px;top:"+(this.newPos.y-g.size)+"px;width:"+64+"px;height:"+128+"px;'>"+"<div style='left: 0; top: 0;'>"+g.spriteHTML[33]+"</div>"+"<div style='left: 32px; top: 0;'>"+g.spriteHTML[34]+"</div>"+"<div style='left: 0px; top: 32px;'>"+g.spriteHTML[35]+"</div>"+"<div style='left: 32px; top: 32px;'>"+g.spriteHTML[36]+"</div>"+"</div>"};if(a.collection){a.collection.push(this)}return this}function m(a){n();var b=a.height||14*g.size,c=a.width||22*g.size,d=a.left||1*g.size,e=a.top||2*g.size,f=a.string||"";g.dom.game.innerHTML+="<p id='msg-text' class='arcadeText' style='padding:"+1*g.size+"px; line-height:"+1*g.size+"px; width:"+c+"px; height:"+b+"px; left:"+d+"px; top:"+e+"px;'>"+f+"</p>"}function n(){if(k("#msg-text")){g.dom.game.removeChild(k("#msg-text"))}}function o(){var a="0123456789ABCDEF";var b="#";for(var c=0;c<3;c++){b+=a.substr(Math.random()*a.length,1)}return b}function p(a){switch(a){case"SPLASH":m({string:g.strings.splash});k("#btn-play").addEventListener("click",function(){g.activeScene="GAME";e()},false);q();break;case"GAME":n();for(var b=0;b<g.knights.length;b++){var c=g.knights[b];switch(c.state){case"J":c.start=c.newPos={x:20+Math.random(),y:15};c.draw();break;case"S":c.start=c.newPos={x:20+Math.random(),y:4};c.draw();break}}g.activeKnight=(new l({id:g.knights.length,start:{x:1,y:15},html:"<div style='left:"+0*16+"px;'>"+g.spriteHTML[17]+"</div>",collection:g.knights})).draw();for(var d=0;d<g.numEnemies;d++){(new l({id:d,start:{x:Math.floor(Math.random()*19)+3,y:Math.floor(Math.random()*14)+2},html:"<div style='left:"+0*16+"px;'>"+g.spriteHTML[16]+"</div>",collection:g.enemies,enemy:true})).draw()}(function f(){cancelAnimationFrame(g.interval);g.interval=requestAnimationFrame(f,g.dom.game);k("#title").style.color=o();for(var a=0;a<g.knights.length;a++){g.knights[a].move();if(!g.breakScene&&g.activeKnight.newPos.x>=18*g.size&&g.activeKnight.newPos.x<=19*g.size+g.size&&g.activeKnight.newPos.y<=5*g.size){g.breakScene=true;g.activeKnight.state="S";g.activeScene="SHIP";g.callbackTime={time:(new Date).getTime(),delay:100}}}for(var b=0;b<g.enemies.length;b++){g.enemies[b].move();if(!g.breakScene&&j(g.activeKnight,g.enemies[b])){g.activeKnight.imprecate();g.breakScene=true;g.activeKnight.state="C";g.activeScene="JAIL";g.callbackTime={time:(new Date).getTime(),delay:3e3}}}if(g.callbackTime&&(new Date).getTime()-g.callbackTime.time>=g.callbackTime.delay){p(g.activeScene)}})();break;case"JAIL":g.activeKnight.toJail();if(g.kJailed===13){g.activeScene="OVER"}else{if(g.numEnemies>5){g.numEnemies--}g.activeScene="GAME"}e();break;case"SHIP":g.activeKnight.toShip();if(g.kShipped===13){g.activeScene="WIN"}else{g.numEnemies++;g.activeScene="GAME"}e();break;case"WIN":m({string:g.strings.win});k("#btn-play").addEventListener("click",function(){g=h();g.activeScene="GAME";e()},false);(function i(){cancelAnimationFrame(g.interval);g.interval=requestAnimationFrame(i,k("#btn-play"));k("#btn-play").style.color=o()})();break;case"OVER":m({string:g.strings.over});k("#btn-play").addEventListener("click",function(){g=h();g.activeScene="GAME";e()},false);q();break}g.callbackTime=null}function q(){cancelAnimationFrame(g.interval);g.interval=requestAnimationFrame(q,k("#colors"));var a="",b=2;for(var c=0;c<50;c++){a+="<div class='stripe' style='top:"+b*c+"%; background:"+o()+";'></div>"}k("#colors").innerHTML=a}"use strict";var a,b,c,d,e;var f={resolution:{width:384,height:272},pixelSize:2};var g=h();(function(){var a=0;var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(b,c){var d=(new Date).getTime();var e=Math.max(0,16-(d-a));var f=window.setTimeout(function(){b(d+e)},e);a=d+e;return f}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(a){clearTimeout(a)}}})();document.onkeydown=document.onkeyup=function(a){g.keys[(a||window.event).keyCode]=(a||window.event).type==="keydown"};window.onload=e=function(){g={pal:g.pal,tiles:g.tiles,strings:g.strings,spriteHTML:g.spriteHTML,mapHTML:"",curScene:g.curScene+1,scene:g.scene,map:g.scene[(g.curScene+1)%g.scene.length][0],coins:0,keys:[],interval:g.interval,size:g.size,knights:g.knights,enemies:[],numEnemies:g.numEnemies,activeKnight:g.activeKnight,kJailed:g.kJailed,kShipped:g.kShipped,breakScene:false,bridge:null,callbackTime:null,activeScene:g.activeScene,dom:{container:k("#container"),game:k("#game")}};g.dom.container.style.width=g.dom.game.style.width=f.resolution.width*f.pixelSize+"px";g.dom.container.style.height=g.dom.game.style.height=f.resolution.height*f.pixelSize+"px";var a,b;for(var c=0;c<g.map.length;c++){a=g.map[c].split("");for(var d=0;d<a.length;d++){b="";if(a[d]!=="0"){b="<div id='map_sprite_"+c+"_"+d+"' class='mapsprite' style='width:"+g.size+"px; height:"+g.size+"px; left:"+d%24*16*f.pixelSize+"px; top:"+Math.floor(d/24)*16*f.pixelSize+"px;'>"+"<div style='height:"+g.size+"px; width:"+48*f.pixelSize+"px;'>"+g.spriteHTML[parseInt(a[d],36)-1]+"</div>"+"</div>"}g.mapHTML+=b}}g.dom.game.innerHTML=g.mapHTML+(g.activeScene==="GAME"?"<p id='title' class='arcadeText' style='line-height:"+g.size+"px; left:"+g.size+"px;'>13th oF fAmE</p>"+"<p id='jail' class='arcadeText' style='"+g.size+"px;line-height:"+1*g.size+"px;'>jail:<span id='jail-txt'>"+g.kJailed+"</span></p><p id='ship' class='arcadeText' style='"+g.size+"px;line-height:"+1*g.size+"px;'>ship:<span id='ship-txt'>"+g.kShipped+"</span></p>":"<p id='title' class='arcadeText' style='line-height:"+g.size+"px; left:"+g.size+"px;'>13th oF fAmE</p>");p(g.activeScene)}})()