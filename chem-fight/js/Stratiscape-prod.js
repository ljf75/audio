(function(){var a=!1,c=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(d){function b(){!a&&this.init&&this.init.apply(this,arguments)}var f=this.prototype;a=!0;var g=new this;a=!1;for(var e in d)g[e]=typeof d[e]=="function"&&typeof f[e]=="function"&&c.test(d[e])?function(a,b){return function(){var c=this._super;this._super=f[a];var e=b.apply(this,arguments);this._super=c;return e}}(e,d[e]):d[e];b.prototype=g;b.constructor=b;b.extend=arguments.callee;return b}})();Stratiscape=function(a){this.layers=[];this.layersByName={};this.container=document.getElementById(a.containerId);var c=this.container.innerHTML;if(document.createElement("canvas").getContext){this.canvasSupported=!0;a.layers.sort(this.layerSortFunction);for(var d in a.layers){var b=a.layers[d];if(b.zIndex>=0){if(Stratiscape.Global.layerNextZIndex<=b.zIndex)Stratiscape.Global.layerNextZIndex=b.zIndex+1}else b.zIndex=Stratiscape.Global.layerNextZIndex++;var f="lyr_"+b.name+b.zIndex,g="";b.backgroundColor&&
(g="background-color:"+b.backgroundColor+";");c+='<canvas id="'+f+'" width="'+b.width+'" height="'+b.height+'" style="position:absolute;left:'+b.x+"px;top:"+b.y+"px;z-index:"+b.zIndex+";"+g+'"></canvas>'}this.container.innerHTML=c;for(d in a.layers){b=a.layers[d];f="lyr_"+b.name+b.zIndex;if(b.mouseHitId){c=document.getElementById(b.mouseHitId);if(b.clickCallback)c.layerConfig=b,Stratiscape.Global.onEvent(c,"click",function(a){var b=Stratiscape.Global.getCursorPosition(a);(a.srcElement||a.target).layerConfig.clickCallback(b)});
if(b.dblclickCallback)c.layerConfig=b,Stratiscape.Global.onEvent(c,"dblclick",function(a){var b=Stratiscape.Global.getCursorPosition(a);(a.srcElement||a.target).layerConfig.dblclickCallback(b)})}b=new Stratiscape.Layer(f,b.name,b.x,b.y,b.width,b.height,b.zIndex);this.layers.push(b);this.layersByName[b.name]=b}}else this.canvasSupported=!1,a.canvasNotSupportedCallback&&a.canvasNotSupportedCallback()};Stratiscape.Global={layerNextZIndex:1};
Stratiscape.Global.getCursorPosition=function(a){var c={x:null,y:null};a.pageX!=void 0&&a.pageY!=void 0?(c.x=a.pageX,c.y=a.pageY):(c.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);a=a.srcElement||a.target;do c.x-=a.offsetLeft||0,c.y-=a.offsetTop||0,a=a.offsetParent;while(a);return c};
Stratiscape.Global.onEvent=function(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d)};Stratiscape.prototype.getLayer=function(a){return this.layersByName[a]?this.layersByName[a]:null};Stratiscape.prototype.draw=function(){for(var a in this.layers)this.layers[a].needsDisplay&&this.layers[a].draw()};Stratiscape.prototype.layerSortFunction=function(a,c){return a.zIndex>c.zIndex?1:a.zIndex<c.zIndex?-1:0};
Stratiscape.Layer=function(a,c,d,b,f,g,e){this.name=c;this.x=d;this.y=b;this.width=f;this.height=g;this.zIndex=e;this.children=[];this.needsDisplay=!1;this.canvas=document.getElementById(a);this.ctx=this.canvas.getContext("2d")};Stratiscape.Layer.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a in this.children)typeof this.children[a].draw=="function"&&this.children[a].draw(this.ctx);this.needsDisplay=!1};
Stratiscape.Layer.prototype.isInBounds=function(a,c){return this.x<=a&&this.y<=c&&this.x+this.width>=a&&this.y+this.height>=c?!0:!1};Stratiscape.Layer.prototype.addChild=function(a){a.layer=this;this.children.push(a);this.needsDisplay=!0};Stratiscape.Layer.prototype.removeChild=function(a){var c=this.children.indexOf(a);if(c!=-1)a.layer=null,this.children.splice(c,1),this.needsDisplay=!0};Stratiscape.DrawnObject=Class.extend({init:function(){this.y=this.x=0;this.layer=null},draw:function(){},isInBounds:function(){return!1}});
