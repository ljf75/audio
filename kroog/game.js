var ctx=document.getElementById("canvas1").getContext("2d");ctx.canvas.width=document.body.offsetWidth;ctx.canvas.height=document.body.offsetHeight;var ctxBg=document.getElementById("canvasBg").getContext("2d");ctxBg.canvas.width=document.body.offsetWidth;ctxBg.canvas.height=document.body.offsetHeight;
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),f=Math.max(0,16-(c-a)),k=window.setTimeout(function(){b(c+f)},f);a=c+f;return k});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();
if("Microsoft Internet Explorer"!=navigator.appName&&!navigator.userAgent.match(/AppleWebKit/)&&!window.opera||navigator.userAgent.match(/Chrome/)){var synth=new SfxrSynth,stateChangeSound=new Audio;stateChangeSound.src=synth.getWave("2,,0.1173,,0.08,0.56,,0.32,,,,,,0.5406,,,,,0.4,,,0.1,,1");var expandingSound=new Audio;expandingSound.src=synth.getWave("2,0.27,1,,1,0.29,,0.06,,,,,,0.5092,,,,,1,,,,,0.6");var finishedSound=new Audio;finishedSound.src=synth.getWave("2,0.06,0.31,0.3329,0.4142,0.5103,,,,,,0.5606,0.5871,,,,,0.6799,0.77,,,,,1");var gameOverSound=
new Audio;gameOverSound.src=synth.getWave("2,0.06,0.31,0.3329,0.4142,0.5103,,,,,,-0.2199,0.5871,,,,,0.6799,0.77,,,,,1");var collectedSound=new Audio;collectedSound.src=synth.getWave("2,0.05,0.068,0.3554,0.3162,0.59,,,,,,0.3799,0.7,,,,,,0.99,,,,,1.3");var specialCollectedSound=new Audio;specialCollectedSound.src=synth.getWave("2,0.06,0.17,0.3329,0.46,0.55,,,,,,0.5606,0.5871,,,,,0.6799,0.77,,,,,0.7")}
var player={speed:200,x:1,y:1,expanding:!1},food={allPieces:[],minQuant:2},enemy={allPieces:[],minQuant:2},alpha=1,levelCollected=0,totalCollected=0,score=0,finalScore=0,difficulty=1,minRequired=1,keysDown=[],currentMode="menu",canRelease=!1,paused=!1,text=[],headingHeight,twitterLinkURL=null,inLink=!1,linkX=ctx.canvas.width/2-120,linkY=ctx.canvas.height/2,linkHeight=30,linkWidth=250,bgGrad,allFloatingWorth=[],floatingActive=!1,floatingWorth=null,floatingWorthX=null,floatingWorthY=null,floatingWorthAlpha=
1,spikeX=0,spikeY=0,instructionsOn=!0,instruction=1;addEventListener("keydown",function(a){keysDown[a.keyCode]=!0},!1);addEventListener("keyup",function(a){delete keysDown[a.keyCode];if(32===a.keyCode&&player.expanding)canRelease=!0;else if(87===a.keyCode&&"game"===currentMode||83===a.keyCode&&"game"===currentMode)restoreSpeed(food.allPieces),restoreSpeed(enemy.allPieces)},!1);
function on_mousemove(a){var b,c;if(a.layerX||a.layerX)b=a.layerX,c=a.layerY;b-=ctx.canvas.offsetLeft;c-=ctx.canvas.offsetTop;b>=linkX&&b<=linkX+linkWidth&&c<=linkY&&c>=linkY-linkHeight?(document.body.style.cursor="pointer",inLink=!0):(document.body.style.cursor="",inLink=!1)}document.body.onclick=function(){"gameover"===currentMode&&inLink&&(window.location=twitterLinkURL.toString())};
document.body.onkeypress=function(a){a="number"==typeof a.which?a.which:a.keyCode;13===a&&"menu"!==currentMode&&(paused=!paused);if(32===a&&0.9<=ctx.globalAlpha&&"game"!==currentMode)switch(currentMode){case "menu":synth&&stateChangeSound.play();player.expanding=!1;resetBgColorstops();currentMode="game";alpha=0;break;case "finished":synth&&stateChangeSound.play();resetBgColorstops();resetVariables();currentMode="game";break;case "gameover":synth&&stateChangeSound.play(),reset()}else if(32===a&&"game"===
currentMode&&!player.expanding)synth&&expandingSound.play(),player.expanding=!0,3===instruction?instruction=4:instructionsOn=!1,canRelease=!1,allFloatingWorth.push({x:player.x,y:player.y,alpha:1,type:"note"});else if(32===a&&("game"===currentMode&&canRelease)&&(player.expanding=!1,levelCollected>=minRequired?(resetBgColorstops(),totalCollected+=levelCollected,difficulty+=1,finalScore+=score,food.minQuant=food.allPieces.length+levelCollected,enemy.minQuant=Math.floor(food.minQuant/1.5),currentMode=
"finished",synth&&finishedSound.play(),alpha=0):(synth&&gameOverSound.play(),resetVariables(),instructionsOn&&(instructionsOn=!1)),synth))expandingSound.currentTime=0,expandingSound.pause()};function reset(){difficulty=1;finalScore=0;currentMode="menu";food.minQuant=2;enemy.minQuant=2;totalCollected=0;twitterLinkURL=null;resetBgColorstops();resetVariables()}
function resizeCanvas(){ctx.canvas.width=document.body.offsetWidth;ctx.canvas.height=document.body.offsetHeight;ctxBg.canvas.width=ctx.canvas.width;ctxBg.canvas.height=ctx.canvas.height;linkX=ctx.canvas.width/2-120;linkY=ctx.canvas.height/3.2+265;render()}
function resetVariables(){1!==difficulty&&instructionsOn&&(instructionsOn=!1);score=levelCollected=0;player.radius=20;player.x=ctx.canvas.width/2;player.y=ctx.canvas.height/2;player.expanding=!1;food.allPieces.length=0;alpha=minRequired=enemy.allPieces.length=0;paused=!1;allFloatingWorth.length=0;generateOther(food);generateOther(enemy);resetPlayerColorstops()}
function update(a){1>=alpha&&(alpha+=0.05,ctx.globalAlpha=alpha);"game"===currentMode&&(playerMovement(a),radiusFluctuate(player,0.05),otherMovement(food.allPieces,a),otherMovement(enemy.allPieces,a),wallCollision())}
function playerMovement(a){if(!player.expanding&&(38 in keysDown&&(player.y-=player.speed*a,2===instruction&&instruction++),40 in keysDown&&(player.y+=player.speed*a,2===instruction&&instruction++),37 in keysDown&&(player.x-=player.speed*a,2===instruction&&instruction++),39 in keysDown))player.x+=player.speed*a,2===instruction&&instruction++;if(player.expanding&&(player.radius+=20*a,foodCollision(),enemyCollision()||wallCollision()))synth&&(expandingSound.currentTime=0,expandingSound.pause()),alpha=
0,synth&&gameOverSound.play(),currentMode="gameover",finalScore+=score,resetBgColorstops(),twitterLinkURL="https://twitter.com/intent/tweet?&text=I+just+reached+"+finalScore+"+points+over+"+difficulty+"+levels+in+KROOG!+-+http://liza.io/KROOG+(cc+@Lazer)"}
function otherMovement(a,b){for(var c=0;c<a.length;c++)(87 in keysDown?(a[c].speedX=a[c].maxSpeedX,a[c].speedY=a[c].maxSpeedY,1===instruction&&instruction++):83 in keysDown&&(a[c].speedX=-a[c].maxSpeedX,a[c].speedY=-a[c].maxSpeedY,1===instruction&&instruction++),a[c].x+=a[c].speedX*b,a[c].y+=a[c].speedY*b,player.expanding)?1>a[c].alpha&&(a[c].alpha+=0.01):(a[c].alpha=0.65,radiusFluctuate(a[c],0.05))}
function radiusFluctuate(a,b){a.radius<a.newRadius&&!a.expanded&&!a.expanding?a.radius+=b:a.radius>=a.newRadius&&(!a.expanded&&!a.expanding)&&(a.expanded=!0);a.radius>a.newRadius-3&&a.expanded&&!a.expanding?a.radius-=b:a.radius<=a.newRadius-3&&(a.radius=a.newRadius-3,a.expanded=!1)}function restoreSpeed(a){for(var b=0;b<a.length;b++)a[b].speedX=a[b].maxSpeedX/30,a[b].speedY=a[b].maxSpeedY/30}
function foodCollision(){for(var a=0;a<food.allPieces.length;a++){var b=food.allPieces[a];radiusFluctuate(b,0.05);var c=Math.sqrt(Math.pow(b.x-player.x,2)+Math.pow(b.y-player.y,2));c<b.radius+player.radius?0.1<b.alpha?b.alpha-=0.1:(1===food.allPieces.length&&"normal"===b.type?(synth&&specialCollectedSound.play(),b.worth*=2):"bonusspecial"===b.type?(synth&&(specialCollectedSound.currentTime=0,specialCollectedSound.play()),b.worth=score*b.special,b.quantityWorth=levelCollected*b.special):"minusMinReq"===
b.type?(synth&&(specialCollectedSound.currentTime=0,specialCollectedSound.play()),b.worth=0,b.quantityWorth=0,minRequired-=b.special):synth&&(collectedSound.currentTime=0,collectedSound.play()),score+=b.worth,allFloatingWorth.push({x:b.x,y:b.y,worth:b.worth,quantityWorth:b.quantityWorth,alpha:1,type:b.type,special:b.special}),food.allPieces.splice(a,1),levelCollected+=b.quantityWorth,updatePlayerColorstops()):c<b.radius+player.radius+10&&(b.x=player.x<b.x?b.x-0.15:b.x+0.15,b.y=player.y<b.y?b.y-0.15:
b.y+0.15)}}function enemyCollision(){for(var a=0;a<enemy.allPieces.length;a++){var b=enemy.allPieces[a],c=Math.sqrt(Math.pow(enemy.allPieces[a].x-player.x,2)+Math.pow(enemy.allPieces[a].y-player.y,2));if(c<b.radius+player.radius+10)return!0;c<b.radius+player.radius+50?radiusFluctuate(b,0.3):radiusFluctuate(b,0.05)}}
function wallCollision(){if(5>player.x-player.radius){if(player.x+=player.radius-player.x+5,player.expanding)return!0}else if(player.x+player.radius>ctx.canvas.width-5&&(player.x=ctx.canvas.width-player.radius-5,player.expanding))return!0;if(5>player.y-player.radius){if(player.y+=player.radius-player.y+5,player.expanding)return!0}else if(player.y+player.radius>ctx.canvas.height-5&&(player.y=ctx.canvas.height-player.radius-5,player.expanding))return!0}
function generateOther(a){for(var b=randomFromTo(a.minQuant,0.5*ctx.canvas.height/100+a.minQuant),c=1;c<=b;c++){var e=20*Math.random()+0-10,d=20*Math.random()+0-10,f=30*e,k=30*d,g=randomFromTo(2*ctx.canvas.height/100+10*difficulty/100,6*ctx.canvas.height/100+difficulty),m=g+3;if(a===food){var h=randomFromTo(0,5*ctx.canvas.height/100-a.allPieces.length),n=1;if(0===h)var h="bonusspecial",i=Math.round(50*g/ctx.canvas.height),l=levelCollected*i,j="*"+i;else 1===h&&3<difficulty?(h="minusMinReq",i=Math.round(50*
g/ctx.canvas.height),l=0,j="-"+i+"req"):(h="normal",i=0,j=l=Math.round(100*g/ctx.canvas.height))}else h="normal",j=null;var o=g+Math.random()*(ctx.canvas.width-2*g),p=g+Math.random()*(ctx.canvas.height-2*g);entity={speedX:e,speedY:d,maxSpeedX:f,maxSpeedY:k,x:o,y:p,radius:g,newRadius:m,worth:l,type:h,note:j,special:i,quantityWorth:n};a.allPieces.push(entity)}minRequired=Math.round(40*food.allPieces.length/100)}
function updatePlayerColorstops(){levelCollected>=minRequired&&(player.colorstop1=bgGradStop2,player.colorstop2=bgGradStop1)}function resetPlayerColorstops(){player.colorstop1="transparent";player.colorstop2="#ffffff"}function resetBgColorstops(){bgGradStop1="#"+("00000"+(16777216*Math.random()<<0).toString(13)).substr(-6);bgGradStop2="#"+("00000"+(16777216*Math.random()<<0).toString(13)).substr(-6)}
function randomFromTo(a,b,c){a+=Math.random()*(b-a);return"undefined"==typeof c?Math.round(a):a.toFixed(c)}function getAngle(a,b,c,e,d){a=e*(Math.PI/180);return{x:b+d*Math.cos(a),y:c+d*Math.sin(a)}}function render(){drawBg();ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);"menu"===currentMode?drawMenuScreen():"game"===currentMode?drawGameScreen():"finished"===currentMode?drawFinishedScreen():"gameover"===currentMode&&drawGameOverScreen();setText();paused&&menuKeys(ctx.canvas.height/3.5,1)}
function setText(){if("finished"===currentMode||"gameover"===currentMode){ctx.textBaseline="top";ctx.fillStyle="white";ctx.font="normal 14px tahoma";ctx.textAlign="left";ctx.textBaseline="top";ctx.lineWidth=1;var a=0,b=ctx.canvas.width/10;switch(currentMode){case "finished":b=ctx.canvas.width/2;a=headingHeight+100;ctx.textAlign="center";ctx.font="normal 19px tahoma";text=["Collected "+levelCollected+" blue bubbles","-----------------------------","Total Score: "+finalScore,"-----------------------------",
"Next Level:  "+difficulty,"","SPACE to start next level"];break;case "gameover":b=ctx.canvas.width/2,a=headingHeight+100,ctx.font="bold 22px tahoma",ctx.textAlign="center",ctx.fillText("FINAL SCORE: "+finalScore,ctx.canvas.width/2,a),ctx.font="normal 19px tahoma",text=["","-----------------------------","Total Collected:  "+totalCollected,"Level Reached: "+difficulty,"-----------------------------","SPACE to play again","","   Tweet your score!"]}for(var c=0;c<text.length;c++)ctx.fillText(text[c],
b,a),a+=20}}function drawBg(){bgGrad=ctxBg.createRadialGradient(ctxBg.canvas.width/2,ctxBg.canvas.height/2,0,ctxBg.canvas.width/2,ctxBg.canvas.height/2,ctxBg.canvas.width/2);bgGrad.addColorStop(0,bgGradStop1);bgGrad.addColorStop(1,bgGradStop2);ctxBg.fillStyle=bgGrad;ctxBg.fillRect(0,0,ctxBg.canvas.width,ctxBg.canvas.height)}
function drawMenuScreen(){ctx.fillStyle="white";ctx.font="bold 110px Helvetica";ctx.textAlign="center";ctx.textBaseline="top";text="KROOG";headingHeight=ctx.canvas.height/20;ctx.fillText(text,ctx.canvas.width/2,headingHeight);menuBlue();menuRed();menuGold();menuKeys(headingHeight+330,0.65)}function drawGameScreen(){drawSpikes();drawPlayer();drawLevelText();drawAllOther();drawFloatingWorth();instructionsOn&&drawGameInstructions()}
function drawGameInstructions(){var a=ctx.canvas.height/8;ctxBg.fillStyle="rgba(0,0,0,0.5)";ctxBg.fillRect(ctx.canvas.width/2-295,a-73,600,145);ctxBg.fill();ctxBg.textAlign="center";ctxBg.font="bold 35px Helvetica";ctxBg.fillStyle="rgba(255,255,255,0.9)";switch(instruction){case 1:ctxBg.fillText("Hold W/S to fast forward/rewind",ctx.canvas.width/2,a-10);ctxBg.font="bold 23px Helvetica";ctxBg.fillText("(Get a feel for the movement)",ctx.canvas.width/2,a+28);break;case 2:ctxBg.fillText("Move with the ARROW KEYS",
ctx.canvas.width/2,a-10);ctxBg.font="bold 22px Helvetica";ctxBg.fillText("Find the best location to pick up blue bubbles",ctx.canvas.width/2,a+18);ctxBg.font="bold 14px Helvetica";ctxBg.fillText("(Don't worry, spiky bubbles don't become deadly until you start expanding)",ctx.canvas.width/2,a+41);break;case 3:ctxBg.fillText("When ready, press SPACE",ctx.canvas.width/2,a-15);ctxBg.font="bold 23px Helvetica";ctxBg.fillText("To start expanding and collecting bubbles",ctx.canvas.width/2,a+13);ctxBg.font=
"bold 15px Helvetica";ctxBg.fillText("You can't move while expanding, but you CAN fast forward/rewind",ctx.canvas.width/2,a+36);break;case 4:ctxBg.font="bold 34px Helvetica",ctxBg.fillText("Press SPACE again to finish level!",ctx.canvas.width/2,a-15),ctxBg.font="bold 25px Helvetica",ctxBg.fillText("Before you run into an edge or spiky bubble",ctx.canvas.width/2,a+13),ctxBg.font="bold 20px Helvetica",ctxBg.fillText("If you haven't collected enough bubbles, the level restarts!",ctx.canvas.width/2,a+
36)}}function drawFinishedScreen(){ctx.font="bold 55px Helvetica";ctx.textAlign="center";ctx.fillStyle="white";ctx.textBaseline="top";headingHeight=ctx.canvas.height/3.2;ctx.fillText("LEVEL COMPLETE",ctx.canvas.width/2,headingHeight)}
function drawGameOverScreen(){ctx.textAlign="center";ctx.fillStyle="white";ctx.textBaseline="top";ctx.canvas.addEventListener("mousemove",on_mousemove,!1);ctx.font="bold 55px Helvetica";headingHeight=ctx.canvas.height/3.2;ctx.fillText("GAME OVER",ctx.canvas.width/2,headingHeight);drawTwitterBird()}
function drawSpikes(){ctxBg.fillStyle="rgba(255,0,0,1)";spikeY=spikeX=0;ctxBg.beginPath();for(var a=0;a<ctxBg.canvas.width/30;a++)ctxBg.moveTo(spikeX,spikeY),ctxBg.lineTo(spikeX+10,spikeY+7),ctxBg.lineTo(spikeX+20,spikeY),spikeX+=30;spikeX=0;spikeY=ctx.canvas.height;for(a=0;a<ctxBg.canvas.width/30;a++)ctxBg.moveTo(spikeX,spikeY),ctxBg.lineTo(spikeX+10,spikeY-7),ctxBg.lineTo(spikeX+20,spikeY),spikeX+=30;for(a=spikeY=spikeX=0;a<ctxBg.canvas.height/30;a++)ctxBg.moveTo(spikeX,spikeY),ctxBg.lineTo(spikeX+
7,spikeY+10),ctxBg.lineTo(spikeX,spikeY+20),spikeY+=30;spikeX=ctx.canvas.width;for(a=spikeY=0;a<ctxBg.canvas.height/30;a++)ctxBg.moveTo(spikeX,spikeY),ctxBg.lineTo(spikeX-7,spikeY+10),ctxBg.lineTo(spikeX,spikeY+20),spikeY+=30;ctxBg.fill()}
function drawLevelText(){ctx.textBaseline="top";ctx.textAlign="left";ctx.fillStyle="rgba(255,255,255,0.9)";ctx.font="bold 17px tahoma";ctx.fillText("Collect at least "+minRequired+" blue bubbles!",10,7);ctx.fillStyle="rgba(255,255,255,0.6)";ctx.fillText("ENTER to view controls",10,27);ctx.textAlign="right";ctx.fillStyle="rgba(255,255,255,0.9)";ctx.fillText("Level: "+difficulty,ctx.canvas.width-10,7);ctx.fillText("Level Score: "+score,ctx.canvas.width-10,27)}
function drawPlayer(){ctx.save();ctx.shadowBlur=15;ctx.shadowColor="white";var a=ctx.createRadialGradient(player.x,player.y,0,player.x,player.y,player.radius);a.addColorStop(0.25,player.colorstop1);a.addColorStop(0.9,player.colorstop2);ctx.fillStyle=a;ctx.beginPath();ctx.arc(player.x,player.y,player.radius,0,2*Math.PI,!0);ctx.closePath();ctx.fill();ctx.restore();ctx.strokeStyle="#ffffff";ctx.stroke();ctx.fillStyle="rgba(255, 255, 255, 1)";ctx.font="21px Helvetica";ctx.textBaseline="middle";ctx.textAlign=
"center";ctx.fillText(levelCollected+"/"+minRequired,player.x,player.y)}
function drawAllOther(){ctx.fillStyle="rgba(255,255,255, 0.5)";ctx.font="17px Helvetica";ctx.textBaseline="middle";ctx.textAlign="center";ctx.lineWidth=1;for(var a=0;a<food.allPieces.length;a++){var b=food.allPieces[a];ctx.save();var c=ctx.createRadialGradient(food.allPieces[a].x-5,b.y+5,0,b.x-5,b.y+5,b.radius);if("normal"===b.type)c.addColorStop(0,"rgba(25, 133, 255,"+b.alpha+")"),c.addColorStop(0.75,"rgba(2, 91, 191,"+b.alpha+")"),c.addColorStop(1,"rgba(5, 79, 162,"+b.alpha+")"),ctx.strokeStyle=
"rgba(2, 32, 86,"+b.alpha+")";else if("bonusspecial"===b.type||"minusMinReq"===b.type)c.addColorStop(0,"rgba(255, 204, 0,"+b.alpha+")"),c.addColorStop(0.75,"rgba(233, 186, 0,"+b.alpha+")"),c.addColorStop(1,"rgba(204, 135, 0,"+b.alpha+")"),ctx.strokeStyle="rgba(171, 121, 0,"+b.alpha+")";ctx.fillStyle=c;ctx.beginPath();ctx.arc(b.x,b.y,b.radius,0,2*Math.PI,!0);ctx.fill();ctx.stroke();ctx.restore();ctx.fillText(b.note,b.x,b.y)}ctx.lineWidth=3;var e=20*Math.PI/180;ctx.strokeStyle="rgba(126,0,0,1)";for(a=
0;a<enemy.allPieces.length;a++){ctx.beginPath();b=enemy.allPieces[a];for(c=0;14>c;c++){var d=getAngle(ctx,b.x,b.y,e,b.radius);ctx.moveTo(d.x,d.y);d=getAngle(ctx,b.x,b.y,e,b.radius+10);ctx.lineTo(d.x,d.y);ctx.stroke();e+=26}ctx.save();ctx.lineWidth=1;ctx.beginPath();c=ctx.createRadialGradient(b.x-5,b.y+5,0,b.x-5,b.y+5,b.radius);c.addColorStop(0,"rgba(255, 48, 0,"+b.alpha+")");c.addColorStop(0.75,"rgba(201, 24, 0,"+b.alpha+")");c.addColorStop(1,"rgba(172, 21, 1,"+b.alpha+")");ctx.fillStyle=c;ctx.arc(b.x,
b.y,b.radius,0,2*Math.PI,!0);ctx.fill();ctx.stroke();ctx.restore()}}
function drawFloatingWorth(){ctx.font="normal 18px Helvetica";for(var a=0;a<allFloatingWorth.length;a++){var b=allFloatingWorth[a];0<b.alpha?(ctx.fillStyle="rgba(255,255,255,"+b.alpha+")",b.y-=1,b.alpha-=0.01,0<food.allPieces.length?"bonusspecial"===b.type?(ctx.fillText("+"+b.worth+" points!",b.x,b.y),ctx.fillText("+"+b.quantityWorth+" collected!",b.x,b.y+20)):"minusMinReq"===b.type?ctx.fillText("-"+b.special+" bubbles required!",b.x,b.y):"note"===b.type?ctx.fillText("Press SPACE again to finish level!",
b.x,b.y):ctx.fillText("+"+b.worth+" points!",b.x,b.y):ctx.fillText("+"+b.worth+" points! (x2 CLEAR BONUS!)",b.x,b.y)):allFloatingWorth.splice(a,1)}}
function drawTwitterBird(){var a=ctx.canvas.width/2-110,b=headingHeight+240,c=25,e=15*(Math.PI/180),d=130*(Math.PI/180);ctx.fillStyle="#00aced";ctx.strokeStyle="#00aced";ctx.beginPath();ctx.arc(a,b,c,e,d,!1);a+=15;b+=2;d=2*Math.PI;ctx.arc(a,b,10,0,d,!1);ctx.fill();a-=32;b-=5;e=15*(Math.PI/180);d=95*(Math.PI/180);ctx.arc(a,b,22,e,d,!1);ctx.moveTo(a+37,b-4);ctx.lineTo(a+45,b-7);ctx.lineTo(a+37,b+1);ctx.lineTo(a+48,b);ctx.lineTo(a+37,b+8);ctx.fill();var c=a+2,e=b-5,d=a+7,f=b+3;ctx.moveTo(a+20,b+8);ctx.quadraticCurveTo(d,
f,c,e);ctx.quadraticCurveTo(d-3,f+5,c+7,e+13);ctx.quadraticCurveTo(d-3,f+5,c-3,e+7);ctx.quadraticCurveTo(d-5,f+8,c+3,e+15);ctx.quadraticCurveTo(d-6,f+10,c-4,e+14);ctx.quadraticCurveTo(d-5,f+15,c+10,e+23);ctx.stroke();ctx.fill();ctx.closePath()}
function menuBlue(){ctx.save();ctx.beginPath();ctx.fillStyle="rgba(25, 133, 255, 1)";ctx.arc(ctx.canvas.width/2,headingHeight+150,30,0,2*Math.PI,!0);ctx.fill();ctx.fillStyle="rgba(255, 255, 255, 0.6)";ctx.font="25px Helvetica";ctx.textBaseline="middle";ctx.textAlign="center";ctx.fillText(3,ctx.canvas.width/2,headingHeight+150);ctx.strokeStyle="rgba(255,255,255,0.6)";ctx.moveTo(ctx.canvas.width/1.95,headingHeight+150);ctx.lineTo(ctx.canvas.width/1.95+30,headingHeight+150);ctx.moveTo(ctx.canvas.width/
2.1,headingHeight+120);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+120);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+180);ctx.lineTo(ctx.canvas.width/2.1,headingHeight+180);ctx.moveTo(ctx.canvas.width/2.1-20,headingHeight+150);ctx.lineTo(ctx.canvas.width/2.1-50,headingHeight+150);ctx.stroke();ctx.closePath();ctx.font="13px Helvetica";ctx.textAlign="left";ctx.fillText("Points for this bubble!",ctx.canvas.width/1.95+33,headingHeight+150);ctx.textAlign="right";ctx.fillText("EXPAND TO EAT ME!",
ctx.canvas.width/2.1-52,headingHeight+150);ctx.restore()}
function menuRed(){ctx.save();var a=20*Math.PI/180;ctx.beginPath();for(var b=0;14>b;b++){ctx.strokeStyle="rgba(172, 21, 1,1)";ctx.lineWidth=3;var c=getAngle(ctx,ctx.canvas.width/2,headingHeight+225,a,20);ctx.moveTo(c.x,c.y);c=getAngle(ctx,ctx.canvas.width/2,headingHeight+225,a,30);ctx.lineTo(c.x,c.y);ctx.stroke();a+=26}ctx.lineWidth=1;ctx.fillStyle="rgba(255, 48, 0, 1)";ctx.beginPath();ctx.arc(ctx.canvas.width/2,headingHeight+225,20,0,2*Math.PI,!0);ctx.fill();ctx.strokeStyle="rgba(255,255,255,0.6)";
ctx.moveTo(ctx.canvas.width/1.95,headingHeight+225);ctx.lineTo(ctx.canvas.width/1.95+30,headingHeight+225);ctx.moveTo(ctx.canvas.width/2.1,headingHeight+195);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+195);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+255);ctx.lineTo(ctx.canvas.width/2.1,headingHeight+255);ctx.moveTo(ctx.canvas.width/2.1-20,headingHeight+225);ctx.lineTo(ctx.canvas.width/2.1-50,headingHeight+225);ctx.stroke();ctx.fillStyle="rgba(255,255,255,0.6)";ctx.font="13px Helvetica";
ctx.textBaseline="middle";ctx.textAlign="left";ctx.fillText("No bonus points! Only doom!",ctx.canvas.width/1.95+33,headingHeight+225);ctx.textAlign="right";ctx.fillText("AVOID AT ALL COSTS!",ctx.canvas.width/2.1-52,headingHeight+225);ctx.restore()}
function menuGold(){ctx.save();ctx.beginPath();ctx.fillStyle="rgba(255, 162, 0, 1)";ctx.arc(ctx.canvas.width/2,headingHeight+290,20,0,2*Math.PI,!0);ctx.fill();ctx.fillStyle="rgba(255, 255, 255, 0.6)";ctx.font="25px Helvetica";ctx.textBaseline="middle";ctx.textAlign="center";ctx.fillText("*2",ctx.canvas.width/2,headingHeight+290);ctx.strokeStyle="rgba(255,255,255,0.6)";ctx.moveTo(ctx.canvas.width/1.935,headingHeight+290);ctx.lineTo(ctx.canvas.width/1.935+30,headingHeight+290);ctx.moveTo(ctx.canvas.width/
2.1,headingHeight+270);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+270);ctx.lineTo(ctx.canvas.width/2.1-20,headingHeight+310);ctx.lineTo(ctx.canvas.width/2.1,headingHeight+310);ctx.moveTo(ctx.canvas.width/2.1-20,headingHeight+290);ctx.lineTo(ctx.canvas.width/2.1-50,headingHeight+290);ctx.stroke();ctx.closePath();ctx.font="13px Helvetica";ctx.textAlign="left";ctx.fillText("Special bonus. Always good!",ctx.canvas.width/1.95+33,headingHeight+290);ctx.textAlign="right";ctx.fillText("RARE GOLDEN BUBBLE!",
ctx.canvas.width/2.1-52,headingHeight+290);ctx.restore()}
function menuKeys(a,b){ctx.fillStyle="rgba(255,255,255,0.5)";ctx.textBaseline="middle";ctx.textAlign="center";ctx.font="bold 25px Helvetica";paused?(ctx.save(),ctx.fillStyle="rgba(0,0,0,0.9)",ctx.fillRect(ctx.canvas.width/2-175,a-15,460,315),ctx.restore(),ctx.fillText("ENTER to close",ctx.canvas.width/2,a+270)):ctx.fillText("SPACE to START",ctx.canvas.width/2,a+270);ctx.font="15px Helvetica";ctx.fillText("Move",ctx.canvas.width/2-67,a+110);ctx.fillText("Fast Forward Bubbles",ctx.canvas.width/2+193,
a+23);ctx.fillText("Rewind Bubbles",ctx.canvas.width/2+173,a+73);ctx.fillText("Press ONCE to START EXPANDING",ctx.canvas.width/2,a+205);ctx.fillText("Press AGAIN to FINISH LEVEL before you die",ctx.canvas.width/2,a+220);ctx.fillText("Double tap to RETRY level",ctx.canvas.width/2,a+235);ctx.fillStyle="rgba(255,255,255,"+b+")";ctx.fillRect(ctx.canvas.width/2-90,a,45,45);ctx.fillRect(ctx.canvas.width/2-140,a+50,45,45);ctx.fillRect(ctx.canvas.width/2-90,a+50,45,45);ctx.fillRect(ctx.canvas.width/2-40,
a+50,45,45);ctx.fillRect(ctx.canvas.width/2+40,a,45,45);ctx.fillRect(ctx.canvas.width/2+50,a+50,45,45);ctx.fillRect(ctx.canvas.width/2-140,a+141,275,45);ctx.strokeStyle="rgba(255,255,255,0.5)";ctx.strokeRect(ctx.canvas.width/2-145,a+136,285,55);ctx.beginPath();ctx.moveTo(ctx.canvas.width/2+85,a+23);ctx.lineTo(ctx.canvas.width/2+120,a+23);ctx.moveTo(ctx.canvas.width/2+95,a+73);ctx.lineTo(ctx.canvas.width/2+120,a+73);ctx.stroke();ctx.fillStyle="rgba(73,73,73,1)";ctx.font="20px Helvetica";ctx.fillText("^",
ctx.canvas.width/2-68,a+25);ctx.fillText("<",ctx.canvas.width/2-118,a+73);ctx.fillText("v",ctx.canvas.width/2-67,a+73);ctx.fillText(">",ctx.canvas.width/2-17,a+73);ctx.fillText("W",ctx.canvas.width/2+63,a+25);ctx.fillText("S",ctx.canvas.width/2+73,a+73);ctx.fillText("SPACE",ctx.canvas.width/2,a+165)}function main(){var a=Date.now(),b=a-then;requestAnimationFrame(main);update(b/1E3);render();then=a}reset();var then=Date.now();resizeCanvas();window.addEventListener("resize",resizeCanvas,!1);requestAnimationFrame(main);